<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biology Simulator - See Your Brain Under Stress</title>
    
    <style>
        /* ===================================================================
           ACCESSIBILITY FEATURES:
           - Full ARIA labels throughout
           - Keyboard navigation support
           - High contrast mode support
           - Screen reader announcements
           - Semantic HTML structure
           - Focus indicators
           - Skip links
        =================================================================== */
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            line-height: 1.6;
            color: #2d3748;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        /* Skip link for keyboard navigation */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: #667eea;
            color: white;
            padding: 8px;
            text-decoration: none;
            z-index: 100;
        }
        
        .skip-link:focus {
            top: 0;
        }
        
        /* Focus indicators */
        *:focus {
            outline: 3px solid #667eea;
            outline-offset: 2px;
        }
        
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.95;
        }
        
        .content {
            padding: 40px 30px;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Screen reader only content */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            white-space: nowrap;
            border-width: 0;
        }
        
        /* Info Boxes */
        .info-box {
            background: #f7fafc;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 25px 0;
            border-radius: 4px;
        }
        
        .info-box.warning {
            border-left-color: #f56565;
            background: #fff5f5;
        }
        
        .info-box.success {
            border-left-color: #48bb78;
            background: #f0fff4;
        }
        
        .info-box h3 {
            margin-bottom: 10px;
            color: #2d3748;
        }
        
        /* Control Panel */
        .control-panel {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .control-row {
            margin-bottom: 25px;
        }
        
        .control-row:last-child {
            margin-bottom: 0;
        }
        
        .control-label {
            font-weight: 600;
            margin-bottom: 10px;
            display: block;
            color: #2d3748;
        }
        
        .radio-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }
        
        .radio-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .radio-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }
        
        .radio-card:focus-within {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
        }
        
        .radio-card input[type="radio"] {
            position: absolute;
            opacity: 0;
        }
        
        .radio-card input[type="radio"]:checked + label {
            color: #667eea;
            font-weight: 600;
        }
        
        .radio-card.selected {
            border-color: #667eea;
            background: #edf2f7;
        }
        
        .radio-card label {
            cursor: pointer;
            display: block;
            font-weight: 500;
        }
        
        .radio-icon {
            font-size: 2em;
            margin-bottom: 8px;
            role: img;
        }
        
        /* Slider */
        .slider-container {
            padding: 15px 0;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }
        
        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 0.9em;
            color: #718096;
        }
        
        .slider-value {
            text-align: center;
            font-size: 1.5em;
            font-weight: 600;
            color: #667eea;
            margin-top: 10px;
        }
        
        /* Buttons */
        .button {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
        }
        
        .button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .button:focus {
            outline: 3px solid #667eea;
            outline-offset: 3px;
        }
        
        .button-secondary {
            background: #718096;
        }
        
        .button-secondary:hover {
            background: #4a5568;
        }
        
        .button-full {
            width: 100%;
            margin-top: 10px;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        /* Comparison Container */
        .comparison-split {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }
        
        .comparison-side {
            background: #f7fafc;
            border-radius: 8px;
            padding: 20px;
            border: 3px solid #e2e8f0;
        }
        
        .comparison-side.scenario-a {
            border-color: #667eea;
        }
        
        .comparison-side.scenario-b {
            border-color: #48bb78;
        }
        
        .scenario-header {
            text-align: center;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-weight: 700;
            font-size: 1.2em;
            color: white;
        }
        
        .scenario-header.scenario-a {
            background: #667eea;
        }
        
        .scenario-header.scenario-b {
            background: #48bb78;
        }
        
        /* Charts */
        .chart-wrapper {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .chart-title {
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
            color: #2d3748;
        }
        
        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: #f7fafc;
            border-radius: 4px;
        }
        
        .metric-label {
            font-weight: 600;
            color: #4a5568;
        }
        
        .metric-value {
            font-size: 1.3em;
            font-weight: 700;
        }
        
        .metric-value.good {
            color: #48bb78;
        }
        
        .metric-value.warning {
            color: #ed8936;
        }
        
        .metric-value.critical {
            color: #f56565;
        }
        
        /* Mobile Responsive */
        @media screen and (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .content {
                padding: 25px 20px;
            }
            
            .comparison-split {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .button {
                width: 100%;
            }
        }
        
        /* High Contrast Mode Support */
        @media (prefers-contrast: high) {
            .button {
                border: 2px solid currentColor;
            }
            
            .radio-card {
                border-width: 3px;
            }
        }
        
        /* Reduced Motion Support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* Print Styles */
        @media print {
            body {
                background: white;
            }
            
            .app-container {
                box-shadow: none;
            }
            
            .button, .skip-link {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- Skip link for keyboard users -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Screen reader announcement region -->
    <div id="sr-announcements" class="sr-only" role="status" aria-live="polite" aria-atomic="true"></div>
    
    <div class="app-container">
        <header class="header" role="banner">
            <h1>üß™ Biology Simulator</h1>
            <p>See How Your Brain Responds to Different Environments</p>
        </header>
        
        <main class="content" id="main-content" role="main">
            <!-- WELCOME SECTION -->
            <section id="welcome" class="section active" aria-labelledby="welcome-heading">
                <h2 id="welcome-heading" style="color: #667eea; margin-bottom: 20px;">Understanding Biology Under Stress</h2>
                
                <p style="margin-bottom: 20px;">This simulator demonstrates <strong>why personal "resilience" cannot overcome toxic institutions</strong> - and why institutional design determines human flourishing.</p>
                
                <div class="info-box" role="region" aria-label="What this simulator shows">
                    <h3>üî¨ What This Simulator Shows</h3>
                    <p><strong>The Great Inversion:</strong> Two institutions with identical physical stress levels produce opposite outcomes based on ONE variable: <strong>institutional design</strong>.</p>
                    <p style="margin-top: 10px;"><strong>Extractive Institution:</strong> No autonomy, no values alignment, algorithmic pace ‚Üí Your brain dysregulates regardless of personal BioBond</p>
                    <p style="margin-top: 10px;"><strong>Metabolic Institution:</strong> Autonomy, values alignment, human-centered design ‚Üí Your brain THRIVES with modest BioBond support</p>
                </div>
                
                <h3 style="color: #667eea; margin: 30px 0 15px;">Understanding Biological Phenotypes</h3>
                
                <p style="margin-bottom: 20px;">People differ in how their nervous systems respond to environmental stress. These differences are biological - not character flaws or strengths.</p>
                
                <div class="info-box" role="region" aria-label="Two independent dimensions explanation">
                    <h3>üìä Two Independent Dimensions</h3>
                    <p><strong>Everyone has ONE phenotype from EACH dimension:</strong></p>
                    <p style="margin-top: 10px;"><strong>Dimension 1: Environmental Sensitivity</strong> (Orchid OR Tulip OR Dandelion)</p>
                    <p><strong>Dimension 2: Stress Response Style</strong> (Warrior OR Balanced OR Worrier)</p>
                    <p style="margin-top: 10px;"><strong>Examples:</strong> You might be "Orchid-Warrior" (20% √ó 25% = 5% of population) or "Dandelion-Worrier" (30% √ó 25% = 7.5% of population). There are 9 possible combinations total.</p>
                    <p style="margin-top: 10px; font-style: italic;">Note: Percentages within each dimension add to 100%. The two dimensions are controlled by different genes (5-HTTLPR for sensitivity, COMT for stress response).</p>
                </div>
                
                <!-- Dimension 1 Cards -->
                <h4 style="color: #667eea; margin: 25px 0 15px; text-align: center; font-size: 1.3em;" id="dimension1-heading">DIMENSION 1: Environmental Sensitivity</h4>
                <p style="text-align: center; margin-bottom: 20px; color: #4a5568;">How responsive is your nervous system to environmental input? (Controlled by 5-HTTLPR gene)</p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 25px 0;" role="region" aria-labelledby="dimension1-heading">
                    <article style="background: white; border: 2px solid #e2e8f0; border-radius: 8px; padding: 20px;">
                        <div style="font-size: 2em; text-align: center; margin-bottom: 10px;" role="img" aria-label="Orchid icon">üå∏</div>
                        <h4 style="color: #667eea; text-align: center; margin-bottom: 10px;">Orchids</h4>
                        <p style="font-size: 0.95em;"><strong>High Environmental Sensitivity</strong></p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 10px;">
                            <strong>Biology:</strong> Short 5-HTTLPR allele ‚Üí serotonin transporter removes serotonin rapidly ‚Üí highly responsive nervous system.
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>In Bad Environments:</strong> Wither quickly, visible collapse (PROTECTIVE - early warning)
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>In Good Environments:</strong> Bloom spectacularly, exceptional performance, deep empathy
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>Approximately 20% of population</strong>
                        </p>
                    </article>
                    
                    <article style="background: white; border: 2px solid #e2e8f0; border-radius: 8px; padding: 20px;">
                        <div style="font-size: 2em; text-align: center; margin-bottom: 10px;" role="img" aria-label="Tulip icon">üå∑</div>
                        <h4 style="color: #667eea; text-align: center; margin-bottom: 10px;">Tulips</h4>
                        <p style="font-size: 0.95em;"><strong>Balanced Sensitivity</strong></p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 10px;">
                            <strong>Biology:</strong> Heterozygous 5-HTTLPR (one short, one long allele) ‚Üí moderate environmental responsiveness.
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>Characteristics:</strong> Respond to both good and bad environments with moderate intensity
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>Profile:</strong> Balanced stress response, adaptable across contexts, middle-range outcomes
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>Approximately 50% of population</strong>
                        </p>
                    </article>
                    
                    <article style="background: white; border: 2px solid #e2e8f0; border-radius: 8px; padding: 20px;">
                        <div style="font-size: 2em; text-align: center; margin-bottom: 10px;" role="img" aria-label="Dandelion icon">üåº</div>
                        <h4 style="color: #667eea; text-align: center; margin-bottom: 10px;">Dandelions</h4>
                        <p style="font-size: 0.95em;"><strong>Low Environmental Sensitivity</strong></p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 10px;">
                            <strong>Biology:</strong> Long 5-HTTLPR allele ‚Üí serotonin stays in synapse longer ‚Üí buffered stress response.
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>In Bad Environments:</strong> Appear "fine" longer but accumulate SILENT damage (cardiovascular, epigenetic)
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>In Good Environments:</strong> Steady, consistent performance but less responsive to extra support
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>Approximately 30% of population</strong>
                        </p>
                    </article>
                </div>
                
                <!-- Dimension 2 Cards -->
                <h4 style="color: #667eea; margin: 35px 0 15px; text-align: center; font-size: 1.3em;" id="dimension2-heading">DIMENSION 2: Stress Response Style</h4>
                <p style="text-align: center; margin-bottom: 20px; color: #4a5568;">How does your brain perform under pressure vs when calm? (Controlled by COMT gene)</p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 25px 0;" role="region" aria-labelledby="dimension2-heading">
                    <article style="background: white; border: 2px solid #e2e8f0; border-radius: 8px; padding: 20px;">
                        <div style="font-size: 2em; text-align: center; margin-bottom: 10px;" role="img" aria-label="Warrior icon">üõ°Ô∏è</div>
                        <h4 style="color: #667eea; text-align: center; margin-bottom: 10px;">Warriors</h4>
                        <p style="font-size: 0.95em;"><strong>Good Performance Under Pressure</strong></p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 10px;">
                            <strong>Biology:</strong> Val/Val COMT variant ‚Üí dopamine degraded quickly ‚Üí functions well when stressed.
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>Strengths:</strong> Crisis performance, quick decisions, action-oriented, doesn't freeze
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>Vulnerability:</strong> May bypass nuance, accumulate damage without feeling it, need mandatory decompression
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>Approximately 25% of population</strong>
                        </p>
                    </article>
                    
                    <article style="background: white; border: 2px solid #e2e8f0; border-radius: 8px; padding: 20px;">
                        <div style="font-size: 2em; text-align: center; margin-bottom: 10px;" role="img" aria-label="Balanced icon">‚öñÔ∏è</div>
                        <h4 style="color: #667eea; text-align: center; margin-bottom: 10px;">Balanced</h4>
                        <p style="font-size: 0.95em;"><strong>Moderate Stress Response</strong></p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 10px;">
                            <strong>Biology:</strong> Val/Met COMT variant ‚Üí moderate dopamine regulation ‚Üí balanced across contexts.
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>Characteristics:</strong> Function reasonably well both under pressure and when calm
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>Profile:</strong> Flexible across situations, no extreme strengths or vulnerabilities
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>Approximately 50% of population</strong>
                        </p>
                    </article>
                    
                    <article style="background: white; border: 2px solid #e2e8f0; border-radius: 8px; padding: 20px;">
                        <div style="font-size: 2em; text-align: center; margin-bottom: 10px;" role="img" aria-label="Worrier icon">üîç</div>
                        <h4 style="color: #667eea; text-align: center; margin-bottom: 10px;">Worriers</h4>
                        <p style="font-size: 0.95em;"><strong>Best Performance When Calm</strong></p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 10px;">
                            <strong>Biology:</strong> Met/Met COMT variant ‚Üí dopamine lingers ‚Üí superior PFC function when unstressed.
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>Strengths:</strong> Exceptional analysis when calm, long-term planning, careful deliberation
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>Vulnerability:</strong> Anxiety/freeze under high pressure, need predictable environments
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>Approximately 25% of population</strong>
                        </p>
                    </article>
                </div>
                
                <!-- Combination Grid -->
                <div class="info-box" role="region" aria-label="Phenotype combinations">
                    <h3>üéØ Key Point: Your Phenotype is a COMBINATION</h3>
                    <p><strong>You are ONE from Dimension 1 + ONE from Dimension 2</strong></p>
                    
                    <div style="margin: 20px 0; padding: 15px; background: white; border-radius: 8px;">
                        <p style="text-align: center; font-weight: 600; margin-bottom: 15px;">The 9 Possible Combinations:</p>
                        <table style="width: 100%; border-collapse: collapse;" role="table" aria-label="Phenotype combination frequencies">
                            <thead>
                                <tr>
                                    <th scope="col" style="text-align: left; padding: 8px;"></th>
                                    <th scope="col" style="text-align: center; padding: 8px; color: #667eea;">üõ°Ô∏è Warrior</th>
                                    <th scope="col" style="text-align: center; padding: 8px; color: #667eea;">‚öñÔ∏è Balanced</th>
                                    <th scope="col" style="text-align: center; padding: 8px; color: #667eea;">üîç Worrier</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th scope="row" style="text-align: right; padding: 8px; color: #667eea;">üå∏ Orchid</th>
                                    <td style="background: #f7fafc; padding: 8px; text-align: center; border-radius: 4px;">Orchid-Warrior<br><span style="font-size: 0.85em; color: #718096;">~5%</span></td>
                                    <td style="background: #f7fafc; padding: 8px; text-align: center; border-radius: 4px;">Orchid-Balanced<br><span style="font-size: 0.85em; color: #718096;">~10%</span></td>
                                    <td style="background: #f7fafc; padding: 8px; text-align: center; border-radius: 4px;">Orchid-Worrier<br><span style="font-size: 0.85em; color: #718096;">~5%</span></td>
                                </tr>
                                <tr>
                                    <th scope="row" style="text-align: right; padding: 8px; color: #667eea;">üå∑ Tulip</th>
                                    <td style="background: #f7fafc; padding: 8px; text-align: center; border-radius: 4px;">Tulip-Warrior<br><span style="font-size: 0.85em; color: #718096;">~12.5%</span></td>
                                    <td style="background: #edf2f7; padding: 8px; text-align: center; border-radius: 4px; font-weight: 600;">Tulip-Balanced<br><span style="font-size: 0.85em; color: #718096;">~25%</span></td>
                                    <td style="background: #f7fafc; padding: 8px; text-align: center; border-radius: 4px;">Tulip-Worrier<br><span style="font-size: 0.85em; color: #718096;">~12.5%</span></td>
                                </tr>
                                <tr>
                                    <th scope="row" style="text-align: right; padding: 8px; color: #667eea;">üåº Dandelion</th>
                                    <td style="background: #f7fafc; padding: 8px; text-align: center; border-radius: 4px;">Dandelion-Warrior<br><span style="font-size: 0.85em; color: #718096;">~7.5%</span></td>
                                    <td style="background: #f7fafc; padding: 8px; text-align: center; border-radius: 4px;">Dandelion-Balanced<br><span style="font-size: 0.85em; color: #718096;">~15%</span></td>
                                    <td style="background: #f7fafc; padding: 8px; text-align: center; border-radius: 4px;">Dandelion-Worrier<br><span style="font-size: 0.85em; color: #718096;">~7.5%</span></td>
                                </tr>
                            </tbody>
                        </table>
                        <p style="text-align: center; margin-top: 15px; font-size: 0.9em; color: #718096; font-style: italic;">Most common: Tulip-Balanced (~25%). Rarest: Orchid extremes (~5% each).</p>
                    </div>
                    
                    <p style="margin-top: 15px;"><strong>Example combinations:</strong></p>
                    <ul style="margin-left: 25px; margin-top: 10px;">
                        <li><strong>Orchid-Warrior:</strong> High sensitivity + good under pressure = sees everything, acts fast (intense!)</li>
                        <li><strong>Dandelion-Worrier:</strong> Low sensitivity + needs calm = steady baseline, strategic thinker</li>
                        <li><strong>Tulip-Balanced:</strong> Moderate on both = adaptable, no extremes</li>
                    </ul>
                    <p style="margin-top: 15px;"><strong>Remember:</strong> These are genetic variants controlled by different genes (5-HTTLPR for sensitivity, COMT for stress response). ALL combinations are adaptive in the right environments.</p>
                    <p style="margin-top: 10px; font-weight: bold;">This is about MATCHING your biology to the right environment, not ranking or changing yourself.</p>
                </div>
                
                <p><strong>System Constraints Overwhelm Individual Effort:</strong></p>
                <ul style="margin-left: 30px; margin-bottom: 15px;">
                    <li>In extractive institutions, even 70% BioBond only gets FHRI to 54 (burnout zone)</li>
                    <li>In metabolic institutions, 40% BioBond achieves FHRI 78 (thriving)</li>
                    <li>Personal "toughening up" CANNOT compensate for extractive design</li>
                </ul>
                
                <div class="info-box warning" role="region" aria-label="Critical insight">
                    <h3>‚ö†Ô∏è Key Insight: Silent Damage vs Observable Harm</h3>
                    <p><strong>Orchids leaving early = PROTECTIVE:</strong> They collapse visibly and exit at Week 8 with FHRI 35, avoiding deeper damage.</p>
                    <p style="margin-top: 10px;"><strong>Dandelions staying longer = WORSE:</strong> They appear "fine" (FHRI 55) but accumulate GrimAge +1.8 years, cardiovascular damage, before finally breaking at Week 32.</p>
                    <p style="margin-top: 10px; font-weight: bold;">High turnover (orchids fleeing) is the CANARY. Low turnover (dandelions enduring) masks catastrophic total harm.</p>
                </div>
                
                <h3 style="color: #667eea; margin: 30px 0 15px;">How to Use This Simulator</h3>
                
                <ol style="margin-left: 30px;">
                    <li><strong>Choose Your Phenotype:</strong> Select one from each dimension</li>
                    <li><strong>Select Environment:</strong> Extractive vs Metabolic institution</li>
                    <li><strong>Set BioBond Level:</strong> 0% (none) to 100% (perfect)</li>
                    <li><strong>Run Simulation:</strong> Watch 12-week trajectory</li>
                    <li><strong>Compare Scenarios:</strong> See how SAME biology + DIFFERENT systems = OPPOSITE outcomes</li>
                </ol>
                
                <nav aria-label="Navigation to simulator setup">
                    <div class="button-group">
                        <button class="button button-full" onclick="showSection('setup')" aria-label="Go to simulation setup">Start Simulation ‚Üí</button>
                    </div>
                </nav>
            </section>
            
            <!-- SETUP SECTION -->
            <section id="setup" class="section" aria-labelledby="setup-heading">
                <h2 id="setup-heading" style="color: #667eea; margin-bottom: 20px;">Configure Your Simulation</h2>
                
                <form class="control-panel" aria-label="Simulation configuration">
                    <fieldset class="control-row">
                        <legend class="control-label">DIMENSION 1: Environmental Sensitivity</legend>
                        <p style="margin-bottom: 15px; color: #4a5568; font-size: 0.95em;">How responsive is this person's nervous system to environmental input? (5-HTTLPR gene)</p>
                        <div class="radio-grid" role="radiogroup" aria-label="Select environmental sensitivity">
                            <div class="radio-card" onclick="selectSensitivity('orchid')" tabindex="0" onkeypress="if(event.key==='Enter')selectSensitivity('orchid')">
                                <input type="radio" name="sensitivity" id="sens-orchid" value="orchid" aria-labelledby="orchid-label">
                                <label for="sens-orchid" id="orchid-label">
                                    <div class="radio-icon" role="img" aria-label="Orchid icon">üå∏</div>
                                    <div>Orchid</div>
                                    <div style="font-size: 0.85em; color: #718096;">High Sensitivity</div>
                                    <div style="font-size: 0.75em; color: #a0aec0; margin-top: 5px;">Responds strongly to both good and bad</div>
                                </label>
                            </div>
                            <div class="radio-card" onclick="selectSensitivity('tulip')" tabindex="0" onkeypress="if(event.key==='Enter')selectSensitivity('tulip')">
                                <input type="radio" name="sensitivity" id="sens-tulip" value="tulip" aria-labelledby="tulip-label">
                                <label for="sens-tulip" id="tulip-label">
                                    <div class="radio-icon" role="img" aria-label="Tulip icon">üå∑</div>
                                    <div>Tulip</div>
                                    <div style="font-size: 0.85em; color: #718096;">Balanced</div>
                                    <div style="font-size: 0.75em; color: #a0aec0; margin-top: 5px;">Moderate responsiveness</div>
                                </label>
                            </div>
                            <div class="radio-card" onclick="selectSensitivity('dandelion')" tabindex="0" onkeypress="if(event.key==='Enter')selectSensitivity('dandelion')">
                                <input type="radio" name="sensitivity" id="sens-dandelion" value="dandelion" aria-labelledby="dandelion-label">
                                <label for="sens-dandelion" id="dandelion-label">
                                    <div class="radio-icon" role="img" aria-label="Dandelion icon">üåº</div>
                                    <div>Dandelion</div>
                                    <div style="font-size: 0.85em; color: #718096;">Low Sensitivity</div>
                                    <div style="font-size: 0.75em; color: #a0aec0; margin-top: 5px;">Robust, masks harm</div>
                                </label>
                            </div>
                        </div>
                    </fieldset>
                    
                    <fieldset class="control-row">
                        <legend class="control-label">DIMENSION 2: Stress Response Style</legend>
                        <p style="margin-bottom: 15px; color: #4a5568; font-size: 0.95em;">How does this person's brain perform under pressure vs when calm? (COMT gene)</p>
                        <div class="radio-grid" role="radiogroup" aria-label="Select stress response style">
                            <div class="radio-card" onclick="selectStress('warrior')" tabindex="0" onkeypress="if(event.key==='Enter')selectStress('warrior')">
                                <input type="radio" name="stress" id="stress-warrior" value="warrior" aria-labelledby="warrior-label">
                                <label for="stress-warrior" id="warrior-label">
                                    <div class="radio-icon" role="img" aria-label="Warrior icon">üõ°Ô∏è</div>
                                    <div>Warrior</div>
                                    <div style="font-size: 0.85em; color: #718096;">Good Under Pressure</div>
                                    <div style="font-size: 0.75em; color: #a0aec0; margin-top: 5px;">Thrives in crisis mode</div>
                                </label>
                            </div>
                            <div class="radio-card" onclick="selectStress('balanced')" tabindex="0" onkeypress="if(event.key==='Enter')selectStress('balanced')">
                                <input type="radio" name="stress" id="stress-balanced" value="balanced" aria-labelledby="balanced-label">
                                <label for="stress-balanced" id="balanced-label">
                                    <div class="radio-icon" role="img" aria-label="Balanced icon">‚öñÔ∏è</div>
                                    <div>Balanced</div>
                                    <div style="font-size: 0.85em; color: #718096;">Moderate</div>
                                    <div style="font-size: 0.75em; color: #a0aec0; margin-top: 5px;">Functional in both contexts</div>
                                </label>
                            </div>
                            <div class="radio-card" onclick="selectStress('worrier')" tabindex="0" onkeypress="if(event.key==='Enter')selectStress('worrier')">
                                <input type="radio" name="stress" id="stress-worrier" value="worrier" aria-labelledby="worrier-label">
                                <label for="stress-worrier" id="worrier-label">
                                    <div class="radio-icon" role="img" aria-label="Worrier icon">üîç</div>
                                    <div>Worrier</div>
                                    <div style="font-size: 0.85em; color: #718096;">Best When Calm</div>
                                    <div style="font-size: 0.75em; color: #a0aec0; margin-top: 5px;">Superior analysis, needs stability</div>
                                </label>
                            </div>
                        </div>
                    </fieldset>
                    
                    <fieldset class="control-row">
                        <legend class="control-label">Institutional Environment</legend>
                        <p style="margin-bottom: 15px; color: #4a5568; font-size: 0.95em;">What kind of system will this person work/study in?</p>
                        <div class="radio-grid" role="radiogroup" aria-label="Select institutional environment">
                            <div class="radio-card" onclick="selectEnvironment('extractive')" tabindex="0" onkeypress="if(event.key==='Enter')selectEnvironment('extractive')">
                                <input type="radio" name="environment" id="env-extractive" value="extractive" aria-labelledby="extractive-label">
                                <label for="env-extractive" id="extractive-label">
                                    <div class="radio-icon" role="img" aria-label="Chains icon">‚õìÔ∏è</div>
                                    <div>Extractive</div>
                                    <div style="font-size: 0.85em; color: #718096;">No autonomy, algorithmic pace</div>
                                    <div style="font-size: 0.75em; color: #a0aec0; margin-top: 5px;">Surveillance, values-misaligned, extractive</div>
                                </label>
                            </div>
                            <div class="radio-card" onclick="selectEnvironment('metabolic')" tabindex="0" onkeypress="if(event.key==='Enter')selectEnvironment('metabolic')">
                                <input type="radio" name="environment" id="env-metabolic" value="metabolic" aria-labelledby="metabolic-label">
                                <label for="env-metabolic" id="metabolic-label">
                                    <div class="radio-icon" role="img" aria-label="Sprout icon">üå±</div>
                                    <div>Metabolic</div>
                                    <div style="font-size: 0.85em; color: #718096;">Autonomy, values-aligned</div>
                                    <div style="font-size: 0.75em; color: #a0aec0; margin-top: 5px;">Supportive, human-centered, sustainable</div>
                                </label>
                            </div>
                        </div>
                        <div style="margin-top: 15px; padding: 15px; background: white; border-radius: 6px; font-size: 0.9em; color: #4a5568;">
                            <p><strong>Extractive Examples:</strong> Amazon warehouse, gig economy platform, for-profit nursing home chain, high-stakes standardized testing school</p>
                            <p style="margin-top: 8px;"><strong>Metabolic Examples:</strong> Worker-owned cooperative, university with tenure protections, Patagonia-style company, supportive healthcare system</p>
                        </div>
                    </fieldset>
                    
                    <div class="control-row">
                        <label for="biobond-slider" class="control-label">BioBond Level: <span id="biobond-display" aria-live="polite">50%</span></label>
                        <div class="slider-container">
                            <input 
                                type="range" 
                                id="biobond-slider" 
                                min="0" 
                                max="100" 
                                value="50" 
                                oninput="updateBioBondDisplay()"
                                aria-label="BioBond level from 0 to 100 percent"
                                aria-valuemin="0"
                                aria-valuemax="100"
                                aria-valuenow="50"
                                aria-valuetext="50 percent BioBond level">
                            <div class="slider-labels" aria-hidden="true">
                                <span>0% (None)</span>
                                <span>50% (Moderate)</span>
                                <span>100% (Perfect)</span>
                            </div>
                        </div>
                        <div style="margin-top: 15px; padding: 15px; background: white; border-radius: 6px; font-size: 0.9em; color: #4a5568;">
                            <strong>BioBond includes:</strong> Sleep hygiene, sensory gating, exercise, social support, moral debt metabolization, threat-challenge reframing
                        </div>
                    </div>
                </form>
                
                <div class="info-box" role="region" aria-label="Experiment ideas">
                    <h3>üí° Experiment Ideas</h3>
                    <p><strong>Experiment 1:</strong> Orchid in extractive (0% BioBond) vs orchid in metabolic (0% BioBond)</p>
                    <p><strong>Experiment 2:</strong> Orchid vs dandelion in SAME extractive environment</p>
                    <p><strong>Experiment 3:</strong> Extractive with 70% BioBond vs metabolic with 30% BioBond</p>
                </div>
                
                <nav aria-label="Simulation mode selection">
                    <div class="button-group">
                        <button class="button button-secondary" onclick="showSection('welcome')" aria-label="Go back to introduction">‚Üê Back</button>
                        <button class="button" onclick="startSimulation()" aria-label="Run single simulation">Run Simulation ‚Üí</button>
                        <button class="button button-secondary" onclick="setupComparison()" aria-label="Set up two-scenario comparison">Compare Two Scenarios</button>
                    </div>
                </nav>
            </section>
            
            <!-- COMPARISON SETUP SECTION -->
            <section id="comparison-setup" class="section" aria-labelledby="comparison-heading">
                <h2 id="comparison-heading" style="color: #667eea; margin-bottom: 20px; text-align: center;">Side-by-Side Comparison</h2>
                
                <p style="text-align: center; margin-bottom: 30px; color: #718096;">Configure two scenarios and watch them run simultaneously</p>
                
                <div class="comparison-split">
                    <!-- Scenario A Setup -->
                    <div class="comparison-side scenario-a" role="region" aria-labelledby="scenario-a-heading">
                        <h3 class="scenario-header scenario-a" id="scenario-a-heading">SCENARIO A</h3>
                        
                        <form aria-label="Scenario A configuration">
                            <fieldset class="control-row">
                                <legend style="font-weight: 600; margin-bottom: 10px;">Sensitivity:</legend>
                                <select id="comp-sens-a" style="width: 100%; padding: 10px; border-radius: 4px; border: 2px solid #e2e8f0; font-size: 1em;" aria-label="Scenario A environmental sensitivity">
                                    <option value="">Select...</option>
                                    <option value="orchid">Orchid üå∏</option>
                                    <option value="tulip">Tulip üå∑</option>
                                    <option value="dandelion">Dandelion üåº</option>
                                </select>
                            </fieldset>
                            
                            <fieldset class="control-row">
                                <legend style="font-weight: 600; margin-bottom: 10px;">Stress Style:</legend>
                                <select id="comp-stress-a" style="width: 100%; padding: 10px; border-radius: 4px; border: 2px solid #e2e8f0; font-size: 1em;" aria-label="Scenario A stress response style">
                                    <option value="">Select...</option>
                                    <option value="warrior">Warrior üõ°Ô∏è</option>
                                    <option value="balanced">Balanced ‚öñÔ∏è</option>
                                    <option value="worrier">Worrier üîç</option>
                                </select>
                            </fieldset>
                            
                            <fieldset class="control-row">
                                <legend style="font-weight: 600; margin-bottom: 10px;">Environment:</legend>
                                <select id="comp-env-a" style="width: 100%; padding: 10px; border-radius: 4px; border: 2px solid #e2e8f0; font-size: 1em;" aria-label="Scenario A institutional environment">
                                    <option value="">Select...</option>
                                    <option value="extractive">Extractive ‚õìÔ∏è</option>
                                    <option value="metabolic">Metabolic üå±</option>
                                </select>
                            </fieldset>
                            
                            <div class="control-row">
                                <label for="comp-biobond-a" style="font-weight: 600; margin-bottom: 10px; display: block;">BioBond: <span id="comp-biobond-display-a" aria-live="polite">50%</span></label>
                                <input 
                                    type="range" 
                                    id="comp-biobond-a" 
                                    min="0" 
                                    max="100" 
                                    value="50" 
                                    oninput="document.getElementById('comp-biobond-display-a').textContent = this.value + '%'"
                                    style="width: 100%;"
                                    aria-label="Scenario A BioBond level"
                                    aria-valuemin="0"
                                    aria-valuemax="100"
                                    aria-valuenow="50">
                            </div>
                        </form>
                    </div>
                    
                    <!-- Scenario B Setup -->
                    <div class="comparison-side scenario-b" role="region" aria-labelledby="scenario-b-heading">
                        <h3 class="scenario-header scenario-b" id="scenario-b-heading">SCENARIO B</h3>
                        
                        <form aria-label="Scenario B configuration">
                            <fieldset class="control-row">
                                <legend style="font-weight: 600; margin-bottom: 10px;">Sensitivity:</legend>
                                <select id="comp-sens-b" style="width: 100%; padding: 10px; border-radius: 4px; border: 2px solid #e2e8f0; font-size: 1em;" aria-label="Scenario B environmental sensitivity">
                                    <option value="">Select...</option>
                                    <option value="orchid">Orchid üå∏</option>
                                    <option value="tulip">Tulip üå∑</option>
                                    <option value="dandelion">Dandelion üåº</option>
                                </select>
                            </fieldset>
                            
                            <fieldset class="control-row">
                                <legend style="font-weight: 600; margin-bottom: 10px;">Stress Style:</legend>
                                <select id="comp-stress-b" style="width: 100%; padding: 10px; border-radius: 4px; border: 2px solid #e2e8f0; font-size: 1em;" aria-label="Scenario B stress response style">
                                    <option value="">Select...</option>
                                    <option value="warrior">Warrior üõ°Ô∏è</option>
                                    <option value="balanced">Balanced ‚öñÔ∏è</option>
                                    <option value="worrier">Worrier üîç</option>
                                </select>
                            </fieldset>
                            
                            <fieldset class="control-row">
                                <legend style="font-weight: 600; margin-bottom: 10px;">Environment:</legend>
                                <select id="comp-env-b" style="width: 100%; padding: 10px; border-radius: 4px; border: 2px solid #e2e8f0; font-size: 1em;" aria-label="Scenario B institutional environment">
                                    <option value="">Select...</option>
                                    <option value="extractive">Extractive ‚õìÔ∏è</option>
                                    <option value="metabolic">Metabolic üå±</option>
                                </select>
                            </fieldset>
                            
                            <div class="control-row">
                                <label for="comp-biobond-b" style="font-weight: 600; margin-bottom: 10px; display: block;">BioBond: <span id="comp-biobond-display-b" aria-live="polite">50%</span></label>
                                <input 
                                    type="range" 
                                    id="comp-biobond-b" 
                                    min="0" 
                                    max="100" 
                                    value="50" 
                                    oninput="document.getElementById('comp-biobond-display-b').textContent = this.value + '%'"
                                    style="width: 100%;"
                                    aria-label="Scenario B BioBond level"
                                    aria-valuemin="0"
                                    aria-valuemax="100"
                                    aria-valuenow="50">
                            </div>
                        </form>
                    </div>
                </div>
                
                <nav aria-label="Comparison actions">
                    <div class="button-group" style="justify-content: center;">
                        <button class="button button-secondary" onclick="showSection('setup')" aria-label="Go back to setup">‚Üê Back</button>
                        <button class="button" onclick="runComparison()" aria-label="Run side-by-side comparison">Run Comparison ‚Üí</button>
                    </div>
                </nav>
            </section>
            
            <!-- COMPARISON RESULTS SECTION -->
            <section id="comparison-results" class="section" aria-labelledby="comparison-results-heading">
                <h2 id="comparison-results-heading" style="color: #667eea; margin-bottom: 20px; text-align: center;">Comparison Results</h2>
                
                <div style="text-align: center; margin-bottom: 30px;">
                    <p style="font-size: 1.2em; font-weight: 600; margin-bottom: 10px;">Week <span id="comp-week-display">0</span></p>
                    <button class="play-button" id="comp-play-button" onclick="toggleComparisonPlay()" aria-label="Play or pause comparison simulation">‚ñ∂Ô∏è</button>
                    <div style="margin-top: 15px;">
                        <button class="button button-secondary" onclick="resetComparison()" style="padding: 10px 30px; font-size: 1em;" aria-label="Reset comparison simulation">Reset</button>
                    </div>
                </div>
                
                <div class="comparison-split">
                    <!-- Scenario A Results -->
                    <div class="comparison-side scenario-a" role="region" aria-labelledby="results-a-heading">
                        <h3 class="scenario-header scenario-a" id="results-a-heading">SCENARIO A</h3>
                        <p id="comp-description-a" style="text-align: center; margin-bottom: 20px; font-size: 0.95em; color: #4a5568;"></p>
                        
                        <div class="chart-wrapper">
                            <div class="metric-row">
                                <span class="metric-label">FHRI:</span>
                                <span id="comp-fhri-a" class="metric-value good" aria-label="Scenario A functional capacity">78</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">C_PFC:</span>
                                <span id="comp-cpfc-a" class="metric-value good" aria-label="Scenario A prefrontal cortex capacity">85%</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">L_GC:</span>
                                <span id="comp-lgc-a" class="metric-value good" aria-label="Scenario A glucocorticoid load">40%</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">MFP:</span>
                                <span id="comp-mfp-a" class="metric-value good" aria-label="Scenario A moral debt">0%</span>
                            </div>
                        </div>
                        
                        <div id="comp-timeline-a" style="margin-top: 20px; padding: 15px; background: white; border-radius: 6px; max-height: 200px; overflow-y: auto;" role="log" aria-label="Scenario A timeline of events">
                            <p style="font-weight: 600; margin-bottom: 10px;">Timeline:</p>
                            <div class="timeline-event milestone">
                                <span class="event-week">Week 0:</span> Simulation begins
                            </div>
                        </div>
                    </div>
                    
                    <!-- Scenario B Results -->
                    <div class="comparison-side scenario-b" role="region" aria-labelledby="results-b-heading">
                        <h3 class="scenario-header scenario-b" id="results-b-heading">SCENARIO B</h3>
                        <p id="comp-description-b" style="text-align: center; margin-bottom: 20px; font-size: 0.95em; color: #4a5568;"></p>
                        
                        <div class="chart-wrapper">
                            <div class="metric-row">
                                <span class="metric-label">FHRI:</span>
                                <span id="comp-fhri-b" class="metric-value good" aria-label="Scenario B functional capacity">78</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">C_PFC:</span>
                                <span id="comp-cpfc-b" class="metric-value good" aria-label="Scenario B prefrontal cortex capacity">85%</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">L_GC:</span>
                                <span id="comp-lgc-b" class="metric-value good" aria-label="Scenario B glucocorticoid load">40%</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">MFP:</span>
                                <span id="comp-mfp-b" class="metric-value good" aria-label="Scenario B moral debt">0%</span>
                            </div>
                        </div>
                        
                        <div id="comp-timeline-b" style="margin-top: 20px; padding: 15px; background: white; border-radius: 6px; max-height: 200px; overflow-y: auto;" role="log" aria-label="Scenario B timeline of events">
                            <p style="font-weight: 600; margin-bottom: 10px;">Timeline:</p>
                            <div class="timeline-event milestone">
                                <span class="event-week">Week 0:</span> Simulation begins
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="comp-final-summary" style="display: none; margin-top: 30px;" role="region" aria-labelledby="comp-summary-heading">
                    <h3 id="comp-summary-heading" style="color: #667eea; text-align: center; margin-bottom: 20px;">Comparison Summary</h3>
                    <div id="comp-summary-content" class="info-box"></div>
                </div>
                
                <nav aria-label="After comparison actions">
                    <div class="button-group">
                        <button class="button button-secondary" onclick="showSection('comparison-setup')" aria-label="Go back to comparison setup">‚Üê New Comparison</button>
                        <button class="button" onclick="showSection('setup')" aria-label="Go to single simulation setup">Single Simulation</button>
                    </div>
                </nav>
            </section>
        </main>
    </div>
    
    <script>
        // ===================================================================
        // ACCESSIBLE BIOLOGY SIMULATOR - JAVASCRIPT
        // ===================================================================
        
        // Accessibility: Announce to screen readers
        function announce(message) {
            const announcer = document.getElementById('sr-announcements');
            announcer.textContent = message;
            // Clear after announcement
            setTimeout(() => announcer.textContent = '', 1000);
        }
        
        // State Management
        let config = {
            sensitivity: null,
            stress: null,
            environment: null,
            biobond: 50
        };
        
        let comparisonState = {
            week: 0,
            isRunning: false,
            intervalId: null,
            scenarioA: {
                sensitivity: null,
                stress: null,
                environment: null,
                biobond: 50,
                data: { lgc: [0.4], cpfc: [0.85], mfp: [0], fhri: [78] },
                events: []
            },
            scenarioB: {
                sensitivity: null,
                stress: null,
                environment: null,
                biobond: 50,
                data: { lgc: [0.4], cpfc: [0.85], mfp: [0], fhri: [78] },
                events: []
            }
        };
        
        // Section Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            window.scrollTo(0, 0);
            
            // Announce section change to screen readers
            const sectionHeading = document.querySelector(`#${sectionId} h2`);
            if (sectionHeading) {
                announce(`Navigated to ${sectionHeading.textContent}`);
            }
        }
        
        // Setup Controls
        function selectSensitivity(type) {
            config.sensitivity = type;
            document.querySelectorAll('.radio-card').forEach(card => {
                if (card.querySelector(`#sens-${type}`)) {
                    card.classList.add('selected');
                } else if (card.querySelector('[name="sensitivity"]')) {
                    card.classList.remove('selected');
                }
            });
            document.getElementById(`sens-${type}`).checked = true;
            announce(`Selected ${type} sensitivity`);
        }
        
        function selectStress(type) {
            config.stress = type;
            document.querySelectorAll('.radio-card').forEach(card => {
                if (card.querySelector(`#stress-${type}`)) {
                    card.classList.add('selected');
                } else if (card.querySelector('[name="stress"]')) {
                    card.classList.remove('selected');
                }
            });
            document.getElementById(`stress-${type}`).checked = true;
            announce(`Selected ${type} stress response`);
        }
        
        function selectEnvironment(type) {
            config.environment = type;
            document.querySelectorAll('.radio-card').forEach(card => {
                if (card.querySelector(`#env-${type}`)) {
                    card.classList.add('selected');
                } else if (card.querySelector('[name="environment"]')) {
                    card.classList.remove('selected');
                }
            });
            document.getElementById(`env-${type}`).checked = true;
            announce(`Selected ${type} environment`);
        }
        
        function updateBioBondDisplay() {
            const value = document.getElementById('biobond-slider').value;
            config.biobond = parseInt(value);
            const display = document.getElementById('biobond-display');
            display.textContent = value + '%';
            document.getElementById('biobond-slider').setAttribute('aria-valuenow', value);
            document.getElementById('biobond-slider').setAttribute('aria-valuetext', `${value} percent BioBond level`);
        }
        
        // Comparison Mode
        function setupComparison() {
            showSection('comparison-setup');
            announce('Setting up side-by-side comparison. Configure both scenarios.');
        }
        
        function runComparison() {
            // Validate both scenarios are configured
            const sensA = document.getElementById('comp-sens-a').value;
            const stressA = document.getElementById('comp-stress-a').value;
            const envA = document.getElementById('comp-env-a').value;
            const sensB = document.getElementById('comp-sens-b').value;
            const stressB = document.getElementById('comp-stress-b').value;
            const envB = document.getElementById('comp-env-b').value;
            
            if (!sensA || !stressA || !envA) {
                alert('Please configure all options for Scenario A');
                return;
            }
            if (!sensB || !stressB || !envB) {
                alert('Please configure all options for Scenario B');
                return;
            }
            
            // Initialize comparison
            comparisonState.week = 0;
            comparisonState.scenarioA = {
                sensitivity: sensA,
                stress: stressA,
                environment: envA,
                biobond: parseInt(document.getElementById('comp-biobond-a').value),
                data: { lgc: [calculateInitialLGC(sensA)], cpfc: [0.85], mfp: [0], fhri: [78] },
                events: [{week: 0, type: 'milestone', text: 'Simulation begins'}]
            };
            comparisonState.scenarioB = {
                sensitivity: sensB,
                stress: stressB,
                environment: envB,
                biobond: parseInt(document.getElementById('comp-biobond-b').value),
                data: { lgc: [calculateInitialLGC(sensB)], cpfc: [0.85], mfp: [0], fhri: [78] },
                events: [{week: 0, type: 'milestone', text: 'Simulation begins'}]
            };
            
            // Show results section
            showSection('comparison-results');
            
            // Update descriptions
            document.getElementById('comp-description-a').textContent = 
                `${capitalize(sensA)}-${capitalize(stressA)} in ${capitalize(envA)} (${comparisonState.scenarioA.biobond}% BioBond)`;
            document.getElementById('comp-description-b').textContent = 
                `${capitalize(sensB)}-${capitalize(stressB)} in ${capitalize(envB)} (${comparisonState.scenarioB.biobond}% BioBond)`;
            
            // Update initial displays
            updateComparisonDisplay();
            
            announce('Comparison initialized. Press play to start both simulations.');
        }
        
        function calculateInitialLGC(sensitivity) {
            const baseLGC = {
                'orchid': 0.45,
                'tulip': 0.40,
                'dandelion': 0.35
            };
            return baseLGC[sensitivity];
        }
        
        function capitalize(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }
        
        function toggleComparisonPlay() {
            if (comparisonState.isRunning) {
                pauseComparison();
            } else {
                playComparison();
            }
        }
        
        function playComparison() {
            comparisonState.isRunning = true;
            document.getElementById('comp-play-button').textContent = '‚è∏Ô∏è';
            document.getElementById('comp-play-button').setAttribute('aria-label', 'Pause comparison simulation');
            announce('Comparison simulation playing');
            
            comparisonState.intervalId = setInterval(() => {
                advanceComparisonWeek();
                if (comparisonState.week >= 12) {
                    pauseComparison();
                    showComparisonSummary();
                }
            }, 1000);
        }
        
        function pauseComparison() {
            comparisonState.isRunning = false;
            document.getElementById('comp-play-button').textContent = '‚ñ∂Ô∏è';
            document.getElementById('comp-play-button').setAttribute('aria-label', 'Play comparison simulation');
            clearInterval(comparisonState.intervalId);
            announce('Comparison simulation paused');
        }
        
        function advanceComparisonWeek() {
            comparisonState.week++;
            document.getElementById('comp-week-display').textContent = comparisonState.week;
            
            // Calculate both scenarios
            calculateScenarioWeek(comparisonState.scenarioA, comparisonState.week);
            calculateScenarioWeek(comparisonState.scenarioB, comparisonState.week);
            
            updateComparisonDisplay();
            
            if (comparisonState.week % 3 === 0) {
                announce(`Week ${comparisonState.week} complete`);
            }
        }
        
        function calculateScenarioWeek(scenario, week) {
            const prevLGC = scenario.data.lgc[week - 1];
            const prevCPFC = scenario.data.cpfc[week - 1];
            const prevMFP = scenario.data.mfp[week - 1];
            
            // Environmental stress input
            const stressInput = scenario.environment === 'extractive' ? 0.15 : 0.05;
            
            // Sensitivity modifier
            const sensModifier = {
                'orchid': 1.5,
                'tulip': 1.0,
                'dandelion': 0.7
            }[scenario.sensitivity];
            
            // BioBond effect
            const biobondEffect = scenario.biobond / 100;
            
            // Calculate new L_GC
            const stressAccumulation = stressInput * sensModifier * (1 - biobondEffect * 0.6);
            const recovery = 0.02 * biobondEffect;
            let newLGC = prevLGC + stressAccumulation - recovery;
            newLGC = Math.max(0.1, Math.min(1.0, newLGC));
            
            // Calculate new C_PFC
            let newCPFC = 0.95 - (newLGC * 0.8);
            if (scenario.stress === 'warrior' && scenario.environment === 'extractive') {
                newCPFC += 0.05;
            } else if (scenario.stress === 'worrier' && scenario.environment === 'extractive') {
                newCPFC -= 0.08;
            }
            newCPFC = Math.max(0.1, Math.min(0.95, newCPFC));
            
            // Calculate Moral Debt
            let newMFP = prevMFP;
            if (scenario.environment === 'extractive') {
                const moralDebtAccrual = 0.04 * (1 - biobondEffect * 0.5);
                newMFP += moralDebtAccrual;
            } else {
                newMFP = Math.max(0, newMFP - 0.02);
            }
            newMFP = Math.max(0, Math.min(1.0, newMFP));
            
            // Calculate FHRI
            const fhriBase = 100 * (0.4 * newCPFC + 0.3 * (1 - newLGC) + 0.3 * (1 - newMFP));
            let newFHRI = fhriBase;
            if (scenario.environment === 'metabolic') {
                newFHRI += 10;
            } else {
                newFHRI -= 5;
            }
            newFHRI = Math.max(10, Math.min(100, newFHRI));
            
            // Store values
            scenario.data.lgc.push(newLGC);
            scenario.data.cpfc.push(newCPFC);
            scenario.data.mfp.push(newMFP);
            scenario.data.fhri.push(newFHRI);
            
            // Check thresholds
            checkScenarioThresholds(scenario, week, newLGC, newCPFC, newMFP, newFHRI);
        }
        
        function checkScenarioThresholds(scenario, week, lgc, cpfc, mfp, fhri) {
            if (cpfc < 0.6 && scenario.data.cpfc[week - 1] >= 0.6) {
                scenario.events.push({week, type: 'warning', text: 'PFC capacity below 60%'});
            }
            if (cpfc < 0.4 && scenario.data.cpfc[week - 1] >= 0.4) {
                scenario.events.push({week, type: 'critical', text: 'PFC critically depleted'});
            }
            if (lgc > 0.7 && scenario.data.lgc[week - 1] <= 0.7) {
                scenario.events.push({week, type: 'warning', text: 'Chronic stress levels'});
            }
            if (mfp > 0.5 && scenario.data.mfp[week - 1] <= 0.5) {
                scenario.events.push({week, type: 'warning', text: 'Significant moral debt'});
            }
            if (fhri < 50 && scenario.data.fhri[week - 1] >= 50) {
                scenario.events.push({week, type: 'critical', text: 'FHRI below 50 - burnout zone'});
            }
        }
        
        function updateComparisonDisplay() {
            const week = comparisonState.week;
            
            // Scenario A
            updateScenarioDisplay('a', comparisonState.scenarioA, week);
            
            // Scenario B
            updateScenarioDisplay('b', comparisonState.scenarioB, week);
        }
        
        function updateScenarioDisplay(id, scenario, week) {
            const fhri = scenario.data.fhri[week];
            const cpfc = scenario.data.cpfc[week];
            const lgc = scenario.data.lgc[week];
            const mfp = scenario.data.mfp[week];
            
            // Update metric displays
            const fhriEl = document.getElementById(`comp-fhri-${id}`);
            fhriEl.textContent = Math.round(fhri);
            fhriEl.className = 'metric-value ' + (fhri >= 70 ? 'good' : fhri >= 50 ? 'warning' : 'critical');
            
            const cpfcEl = document.getElementById(`comp-cpfc-${id}`);
            cpfcEl.textContent = Math.round(cpfc * 100) + '%';
            cpfcEl.className = 'metric-value ' + (cpfc >= 0.6 ? 'good' : cpfc >= 0.4 ? 'warning' : 'critical');
            
            const lgcEl = document.getElementById(`comp-lgc-${id}`);
            lgcEl.textContent = Math.round(lgc * 100) + '%';
            lgcEl.className = 'metric-value ' + (lgc <= 0.6 ? 'good' : lgc <= 0.8 ? 'warning' : 'critical');
            
            const mfpEl = document.getElementById(`comp-mfp-${id}`);
            mfpEl.textContent = Math.round(mfp * 100) + '%';
            mfpEl.className = 'metric-value ' + (mfp <= 0.4 ? 'good' : mfp <= 0.7 ? 'warning' : 'critical');
            
            // Update timeline
            const timelineEl = document.getElementById(`comp-timeline-${id}`);
            const eventsHtml = scenario.events.map(event => `
                <div class="timeline-event ${event.type}">
                    <span class="event-week">Week ${event.week}:</span> ${event.text}
                </div>
            `).join('');
            timelineEl.innerHTML = '<p style="font-weight: 600; margin-bottom: 10px;">Timeline:</p>' + eventsHtml;
            timelineEl.scrollTop = timelineEl.scrollHeight;
        }
        
        function showComparisonSummary() {
            const summaryEl = document.getElementById('comp-summary-content');
            const fhriA = Math.round(comparisonState.scenarioA.data.fhri[12]);
            const fhriB = Math.round(comparisonState.scenarioB.data.fhri[12]);
            
            let html = '<h3>üìä 12-Week Comparison Complete</h3>';
            html += '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">';
            
            html += '<div style="border: 3px solid #667eea; padding: 15px; border-radius: 8px;">';
            html += '<p style="font-weight: 600; color: #667eea; margin-bottom: 10px;">SCENARIO A</p>';
            html += `<p style="font-size: 2em; font-weight: 700; color: ${fhriA >= 70 ? '#48bb78' : fhriA >= 50 ? '#ed8936' : '#f56565'};">FHRI: ${fhriA}</p>`;
            html += `<p>${fhriA >= 70 ? '‚úì Thriving' : fhriA >= 50 ? '‚ö† Struggling' : 'üö® Crisis'}</p>`;
            html += '</div>';
            
            html += '<div style="border: 3px solid #48bb78; padding: 15px; border-radius: 8px;">';
            html += '<p style="font-weight: 600; color: #48bb78; margin-bottom: 10px;">SCENARIO B</p>';
            html += `<p style="font-size: 2em; font-weight: 700; color: ${fhriB >= 70 ? '#48bb78' : fhriB >= 50 ? '#ed8936' : '#f56565'};">FHRI: ${fhriB}</p>`;
            html += `<p>${fhriB >= 70 ? '‚úì Thriving' : fhriB >= 50 ? '‚ö† Struggling' : 'üö® Crisis'}</p>`;
            html += '</div>';
            
            html += '</div>';
            
            html += '<p style="margin-top: 20px;"><strong>Key Insight:</strong></p>';
            const diff = Math.abs(fhriA - fhriB);
            if (diff > 20) {
                html += `<p>Substantial difference (${diff} points) demonstrates how institutional design ${fhriA > fhriB ? 'or' : 'and'} phenotype matching determine outcomes far more than individual effort.</p>`;
            } else {
                html += '<p>Similar outcomes suggest both environments are either supportive or extractive, or phenotypes respond similarly to these conditions.</p>';
            }
            
            summaryEl.innerHTML = html;
            document.getElementById('comp-final-summary').style.display = 'block';
            
            announce('Comparison complete. Review summary for detailed results.');
        }
        
        function resetComparison() {
            pauseComparison();
            comparisonState.week = 0;
            document.getElementById('comp-week-display').textContent = '0';
            document.getElementById('comp-final-summary').style.display = 'none';
            
            // Reset both scenarios
            comparisonState.scenarioA.data = { 
                lgc: [calculateInitialLGC(comparisonState.scenarioA.sensitivity)], 
                cpfc: [0.85], 
                mfp: [0], 
                fhri: [78] 
            };
            comparisonState.scenarioA.events = [{week: 0, type: 'milestone', text: 'Simulation begins'}];
            
            comparisonState.scenarioB.data = { 
                lgc: [calculateInitialLGC(comparisonState.scenarioB.sensitivity)], 
                cpfc: [0.85], 
                mfp: [0], 
                fhri: [78] 
            };
            comparisonState.scenarioB.events = [{week: 0, type: 'milestone', text: 'Simulation begins'}];
            
            updateComparisonDisplay();
            announce('Comparison reset to week zero');
        }
        
        // Single simulation placeholder (keeping basic structure)
        function startSimulation() {
            if (!config.sensitivity || !config.stress || !config.environment) {
                alert('Please select all options before starting.');
                return;
            }
            alert('Single simulation mode: Full implementation would show animated charts. Use comparison mode for functional demo.');
        }
        
        // Keyboard navigation for radio cards
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.radio-card').forEach(card => {
                card.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        card.click();
                    }
                });
            });
        });
    </script>
</body>
</html>
