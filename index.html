<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biology Simulator - See Your Brain Under Stress</title>
    
    <style>
        /* ===================================================================
           CANVAS DEPLOYMENT INSTRUCTIONS:
           
           Same as APP 1 & 2:
           1. Select ALL ‚Üí Copy
           2. Canvas ‚Üí Pages ‚Üí + Page ‚Üí "Biology Simulator"
           3. HTML Editor ‚Üí Paste ‚Üí Save & Publish
           4. Add to Module (recommend BEFORE APP 1 as introduction)
        =================================================================== */
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            line-height: 1.6;
            color: #2d3748;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.95;
        }
        
        .content {
            padding: 40px 30px;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Info Boxes */
        .info-box {
            background: #f7fafc;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 25px 0;
            border-radius: 4px;
        }
        
        .info-box.warning {
            border-left-color: #f56565;
            background: #fff5f5;
        }
        
        .info-box.success {
            border-left-color: #48bb78;
            background: #f0fff4;
        }
        
        .info-box h3 {
            margin-bottom: 10px;
            color: #2d3748;
        }
        
        /* Control Panel */
        .control-panel {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .control-row {
            margin-bottom: 25px;
        }
        
        .control-row:last-child {
            margin-bottom: 0;
        }
        
        .control-label {
            font-weight: 600;
            margin-bottom: 10px;
            display: block;
            color: #2d3748;
        }
        
        .radio-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }
        
        .radio-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .radio-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }
        
        .radio-card input[type="radio"] {
            display: none;
        }
        
        .radio-card input[type="radio"]:checked + label {
            color: #667eea;
            font-weight: 600;
        }
        
        .radio-card.selected {
            border-color: #667eea;
            background: #edf2f7;
        }
        
        .radio-card label {
            cursor: pointer;
            display: block;
            font-weight: 500;
        }
        
        .radio-icon {
            font-size: 2em;
            margin-bottom: 8px;
        }
        
        /* Slider */
        .slider-container {
            padding: 15px 0;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }
        
        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 0.9em;
            color: #718096;
        }
        
        .slider-value {
            text-align: center;
            font-size: 1.5em;
            font-weight: 600;
            color: #667eea;
            margin-top: 10px;
        }
        
        /* Buttons */
        .button {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
        }
        
        .button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .button-secondary {
            background: #718096;
        }
        
        .button-secondary:hover {
            background: #4a5568;
        }
        
        .button-full {
            width: 100%;
            margin-top: 10px;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        /* Simulation Display */
        .simulation-container {
            background: #f7fafc;
            border-radius: 8px;
            padding: 25px;
            margin: 30px 0;
        }
        
        .sim-header {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .sim-header h2 {
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 10px;
        }
        
        .week-display {
            font-size: 1.5em;
            font-weight: 600;
            color: #2d3748;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .chart-wrapper {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .chart-title {
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
            color: #2d3748;
        }
        
        .metric-display {
            text-align: center;
            font-size: 2.5em;
            font-weight: 700;
            margin: 20px 0;
        }
        
        .metric-display.good {
            color: #48bb78;
        }
        
        .metric-display.warning {
            color: #ed8936;
        }
        
        .metric-display.critical {
            color: #f56565;
        }
        
        /* Timeline Events */
        .timeline-events {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 25px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .timeline-event {
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid #e2e8f0;
            background: #f7fafc;
            border-radius: 4px;
        }
        
        .timeline-event.milestone {
            border-left-color: #667eea;
            background: #edf2f7;
        }
        
        .timeline-event.warning {
            border-left-color: #ed8936;
            background: #fffaf0;
        }
        
        .timeline-event.critical {
            border-left-color: #f56565;
            background: #fff5f5;
        }
        
        .event-week {
            font-weight: 600;
            color: #667eea;
            margin-right: 10px;
        }
        
        /* Comparison Mode */
        .comparison-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }
        
        .comparison-panel {
            background: white;
            border-radius: 8px;
            padding: 25px;
            border: 3px solid #e2e8f0;
        }
        
        .comparison-panel.left {
            border-color: #667eea;
        }
        
        .comparison-panel.right {
            border-color: #48bb78;
        }
        
        .panel-header {
            text-align: center;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-weight: 600;
            color: white;
        }
        
        .panel-header.left {
            background: #667eea;
        }
        
        .panel-header.right {
            background: #48bb78;
        }
        
        /* Play Controls */
        .play-controls {
            text-align: center;
            margin: 30px 0;
        }
        
        .play-button {
            font-size: 3em;
            background: #48bb78;
            color: white;
            border: none;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .play-button:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 30px rgba(72, 187, 120, 0.4);
        }
        
        .play-button.playing {
            background: #f56565;
        }
        
        /* Mobile Responsive */
        @media screen and (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .content {
                padding: 25px 20px;
            }
            
            .comparison-container {
                grid-template-columns: 1fr;
            }
            
            .charts-container {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .button {
                width: 100%;
            }
        }
        
        /* Print Styles */
        @media print {
            body {
                background: white;
            }
            
            .app-container {
                box-shadow: none;
            }
            
            .button, .play-controls, #welcome, #setup {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>üß™ Biology Simulator</h1>
            <p>See How Your Brain Responds to Different Environments</p>
        </div>
        
        <div class="content">
            <!-- WELCOME SECTION -->
            <div id="welcome" class="section active">
                <h2 style="color: #667eea; margin-bottom: 20px;">Understanding Biology Under Stress</h2>
                
                <p style="margin-bottom: 20px;">This simulator demonstrates <strong>why personal "resilience" cannot overcome toxic institutions</strong> - and why institutional design determines human flourishing.</p>
                
                <div class="info-box">
                    <h3>üî¨ What This Simulator Shows</h3>
                    <p><strong>The Great Inversion:</strong> Two institutions with identical physical stress levels produce opposite outcomes based on ONE variable: <strong>institutional design</strong>.</p>
                    <p style="margin-top: 10px;"><strong>Extractive Institution:</strong> No autonomy, no values alignment, algorithmic pace ‚Üí Your brain dysregulates regardless of personal BioBond</p>
                    <p style="margin-top: 10px;"><strong>Metabolic Institution:</strong> Autonomy, values alignment, human-centered design ‚Üí Your brain THRIVES with modest BioBond support</p>
                </div>
                
                <h3 style="color: #667eea; margin: 30px 0 15px;">Understanding Biological Phenotypes</h3>
                
                <p style="margin-bottom: 20px;">People differ in how their nervous systems respond to environmental stress. These differences are biological - not character flaws or strengths.</p>
                
                <div class="info-box">
                    <h3>üìä Two Independent Dimensions</h3>
                    <p><strong>Everyone has ONE phenotype from EACH dimension:</strong></p>
                    <p style="margin-top: 10px;"><strong>Dimension 1: Environmental Sensitivity</strong> (Orchid OR Tulip OR Dandelion)</p>
                    <p><strong>Dimension 2: Stress Response Style</strong> (Warrior OR Balanced OR Worrier)</p>
                    <p style="margin-top: 10px;"><strong>Examples:</strong> You might be "Orchid-Warrior" (20% √ó 25% = 5% of population) or "Dandelion-Worrier" (30% √ó 25% = 7.5% of population). There are 9 possible combinations total.</p>
                    <p style="margin-top: 10px; font-style: italic;">Note: Percentages within each dimension add to 100%. The two dimensions are controlled by different genes (5-HTTLPR for sensitivity, COMT for stress response).</p>
                </div>
                
                <!-- Phenotype Cards -->
                <h4 style="color: #667eea; margin: 25px 0 15px; text-align: center; font-size: 1.3em;">DIMENSION 1: Environmental Sensitivity</h4>
                <p style="text-align: center; margin-bottom: 20px; color: #4a5568;">How responsive is your nervous system to environmental input? (Controlled by 5-HTTLPR gene)</p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 25px 0;">
                    <div style="background: white; border: 2px solid #e2e8f0; border-radius: 8px; padding: 20px;">
                        <div style="font-size: 2em; text-align: center; margin-bottom: 10px;">üå∏</div>
                        <h4 style="color: #667eea; text-align: center; margin-bottom: 10px;">Orchids</h4>
                        <p style="font-size: 0.95em;"><strong>High Environmental Sensitivity</strong></p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 10px;">
                            <strong>Biology:</strong> Short 5-HTTLPR allele ‚Üí serotonin transporter removes serotonin rapidly ‚Üí highly responsive nervous system.
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>In Bad Environments:</strong> Wither quickly, visible collapse (PROTECTIVE - early warning)
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>In Good Environments:</strong> Bloom spectacularly, exceptional performance, deep empathy
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>~20% of population</strong>
                        </p>
                    </div>
                    
                    <div style="background: white; border: 2px solid #e2e8f0; border-radius: 8px; padding: 20px;">
                        <div style="font-size: 2em; text-align: center; margin-bottom: 10px;">üå∑</div>
                        <h4 style="color: #667eea; text-align: center; margin-bottom: 10px;">Tulips</h4>
                        <p style="font-size: 0.95em;"><strong>Balanced Sensitivity</strong></p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 10px;">
                            <strong>Biology:</strong> Heterozygous 5-HTTLPR (one short, one long allele) ‚Üí moderate environmental responsiveness.
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>Characteristics:</strong> Respond to both good and bad environments with moderate intensity
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>Profile:</strong> Balanced stress response, adaptable across contexts, middle-range outcomes
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>~50% of population</strong>
                        </p>
                    </div>
                    
                    <div style="background: white; border: 2px solid #e2e8f0; border-radius: 8px; padding: 20px;">
                        <div style="font-size: 2em; text-align: center; margin-bottom: 10px;">üåº</div>
                        <h4 style="color: #667eea; text-align: center; margin-bottom: 10px;">Dandelions</h4>
                        <p style="font-size: 0.95em;"><strong>Low Environmental Sensitivity</strong></p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 10px;">
                            <strong>Biology:</strong> Long 5-HTTLPR allele ‚Üí serotonin stays in synapse longer ‚Üí buffered stress response.
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>In Bad Environments:</strong> Appear "fine" longer but accumulate SILENT damage (cardiovascular, epigenetic)
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>In Good Environments:</strong> Steady, consistent performance but less responsive to extra support
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>~30% of population</strong>
                        </p>
                    </div>
                </div>
                
                <h4 style="color: #667eea; margin: 35px 0 15px; text-align: center; font-size: 1.3em;">DIMENSION 2: Stress Response Style</h4>
                <p style="text-align: center; margin-bottom: 20px; color: #4a5568;">How does your brain perform under pressure vs when calm? (Controlled by COMT gene)</p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 25px 0;">
                    <div style="background: white; border: 2px solid #e2e8f0; border-radius: 8px; padding: 20px;">
                        <div style="font-size: 2em; text-align: center; margin-bottom: 10px;">üõ°Ô∏è</div>
                        <h4 style="color: #667eea; text-align: center; margin-bottom: 10px;">Warriors</h4>
                        <p style="font-size: 0.95em;"><strong>Good Performance Under Pressure</strong></p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 10px;">
                            <strong>Biology:</strong> Val/Val COMT variant ‚Üí dopamine degraded quickly ‚Üí functions well when stressed.
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>Strengths:</strong> Crisis performance, quick decisions, action-oriented, doesn't freeze
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>Vulnerability:</strong> May bypass nuance, accumulate damage without feeling it, need mandatory decompression
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>~25% of population</strong>
                        </p>
                    </div>
                    
                    <div style="background: white; border: 2px solid #e2e8f0; border-radius: 8px; padding: 20px;">
                        <div style="font-size: 2em; text-align: center; margin-bottom: 10px;">‚öñÔ∏è</div>
                        <h4 style="color: #667eea; text-align: center; margin-bottom: 10px;">Balanced</h4>
                        <p style="font-size: 0.95em;"><strong>Moderate Stress Response</strong></p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 10px;">
                            <strong>Biology:</strong> Val/Met COMT variant ‚Üí moderate dopamine regulation ‚Üí balanced across contexts.
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>Characteristics:</strong> Function reasonably well both under pressure and when calm
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>Profile:</strong> Flexible across situations, no extreme strengths or vulnerabilities
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>~50% of population</strong>
                        </p>
                    </div>
                    
                    <div style="background: white; border: 2px solid #e2e8f0; border-radius: 8px; padding: 20px;">
                        <div style="font-size: 2em; text-align: center; margin-bottom: 10px;">üîç</div>
                        <h4 style="color: #667eea; text-align: center; margin-bottom: 10px;">Worriers</h4>
                        <p style="font-size: 0.95em;"><strong>Best Performance When Calm</strong></p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 10px;">
                            <strong>Biology:</strong> Met/Met COMT variant ‚Üí dopamine lingers ‚Üí superior PFC function when unstressed.
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>Strengths:</strong> Exceptional analysis when calm, long-term planning, careful deliberation
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>Vulnerability:</strong> Anxiety/freeze under high pressure, need predictable environments
                        </p>
                        <p style="font-size: 0.9em; color: #4a5568; margin-top: 8px;">
                            <strong>~25% of population</strong>
                        </p>
                    </div>
                </div>
                
                <div class="info-box">
                    <h3>üéØ Key Point: Your Phenotype is a COMBINATION</h3>
                    <p><strong>You are ONE from Dimension 1 + ONE from Dimension 2</strong></p>
                    
                    <div style="margin: 20px 0; padding: 15px; background: white; border-radius: 8px;">
                        <p style="text-align: center; font-weight: 600; margin-bottom: 15px;">The 9 Possible Combinations:</p>
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; font-size: 0.85em;">
                            <div style="font-weight: 600; text-align: center;"></div>
                            <div style="font-weight: 600; text-align: center; color: #667eea;">üõ°Ô∏è Warrior</div>
                            <div style="font-weight: 600; text-align: center; color: #667eea;">‚öñÔ∏è Balanced</div>
                            <div style="font-weight: 600; text-align: center; color: #667eea;">üîç Worrier</div>
                            
                            <div style="font-weight: 600; text-align: right; color: #667eea; padding-right: 10px;">üå∏ Orchid</div>
                            <div style="background: #f7fafc; padding: 8px; text-align: center; border-radius: 4px;">Orchid-Warrior<br><span style="font-size: 0.85em; color: #718096;">~5%</span></div>
                            <div style="background: #f7fafc; padding: 8px; text-align: center; border-radius: 4px;">Orchid-Balanced<br><span style="font-size: 0.85em; color: #718096;">~10%</span></div>
                            <div style="background: #f7fafc; padding: 8px; text-align: center; border-radius: 4px;">Orchid-Worrier<br><span style="font-size: 0.85em; color: #718096;">~5%</span></div>
                            
                            <div style="font-weight: 600; text-align: right; color: #667eea; padding-right: 10px;">üå∑ Tulip</div>
                            <div style="background: #f7fafc; padding: 8px; text-align: center; border-radius: 4px;">Tulip-Warrior<br><span style="font-size: 0.85em; color: #718096;">~12.5%</span></div>
                            <div style="background: #edf2f7; padding: 8px; text-align: center; border-radius: 4px; font-weight: 600;">Tulip-Balanced<br><span style="font-size: 0.85em; color: #718096;">~25%</span></div>
                            <div style="background: #f7fafc; padding: 8px; text-align: center; border-radius: 4px;">Tulip-Worrier<br><span style="font-size: 0.85em; color: #718096;">~12.5%</span></div>
                            
                            <div style="font-weight: 600; text-align: right; color: #667eea; padding-right: 10px;">üåº Dandelion</div>
                            <div style="background: #f7fafc; padding: 8px; text-align: center; border-radius: 4px;">Dandelion-Warrior<br><span style="font-size: 0.85em; color: #718096;">~7.5%</span></div>
                            <div style="background: #f7fafc; padding: 8px; text-align: center; border-radius: 4px;">Dandelion-Balanced<br><span style="font-size: 0.85em; color: #718096;">~15%</span></div>
                            <div style="background: #f7fafc; padding: 8px; text-align: center; border-radius: 4px;">Dandelion-Worrier<br><span style="font-size: 0.85em; color: #718096;">~7.5%</span></div>
                        </div>
                        <p style="text-align: center; margin-top: 15px; font-size: 0.9em; color: #718096; font-style: italic;">Most common: Tulip-Balanced (~25%). Rarest: Orchid extremes (~5% each).</p>
                    </div>
                    
                    <p style="margin-top: 15px;"><strong>Example combinations:</strong></p>
                    <ul style="margin-left: 25px; margin-top: 10px;">
                        <li><strong>Orchid-Warrior:</strong> High sensitivity + good under pressure = sees everything, acts fast (intense!)</li>
                        <li><strong>Dandelion-Worrier:</strong> Low sensitivity + needs calm = steady baseline, strategic thinker</li>
                        <li><strong>Tulip-Balanced:</strong> Moderate on both = adaptable, no extremes</li>
                    </ul>
                    <p style="margin-top: 15px;"><strong>Remember:</strong> These are genetic variants controlled by different genes (5-HTTLPR for sensitivity, COMT for stress response). ALL combinations are adaptive in the right environments.</p>
                    <p style="margin-top: 10px; font-weight: bold;">This is about MATCHING your biology to the right environment, not ranking or changing yourself.</p>
                </div>
                
                <p><strong>System Constraints Overwhelm Individual Effort:</strong></p>
                <ul style="margin-left: 30px; margin-bottom: 15px;">
                    <li>In extractive institutions, even 70% BioBond only gets FHRI to 54 (burnout zone)</li>
                    <li>In metabolic institutions, 40% BioBond achieves FHRI 78 (thriving)</li>
                    <li>Personal "toughening up" CANNOT compensate for extractive design</li>
                </ul>
                
                <div class="info-box warning">
                    <h3>‚ö†Ô∏è Key Insight: Silent Damage vs Observable Harm</h3>
                    <p><strong>Orchids leaving early = PROTECTIVE:</strong> They collapse visibly and exit at Week 8 with FHRI 35, avoiding deeper damage.</p>
                    <p style="margin-top: 10px;"><strong>Dandelions staying longer = WORSE:</strong> They appear "fine" (FHRI 55) but accumulate GrimAge +1.8 years, cardiovascular damage, before finally breaking at Week 32.</p>
                    <p style="margin-top: 10px; font-weight: bold;">High turnover (orchids fleeing) is the CANARY. Low turnover (dandelions enduring) masks catastrophic total harm.</p>
                </div>
                
                <h3 style="color: #667eea; margin: 30px 0 15px;">How to Use This Simulator</h3>
                
                <p>1. <strong>Choose Your Phenotype:</strong> Orchid/Dandelion sensitivity, Warrior/Worrier stress style</p>
                <p>2. <strong>Select Environment:</strong> Extractive vs Metabolic institution</p>
                <p>3. <strong>Set BioBond Level:</strong> 0% (none) to 100% (perfect)</p>
                <p>4. <strong>Run Simulation:</strong> Watch 12-week trajectory</p>
                <p>5. <strong>Compare Scenarios:</strong> See how SAME biology + DIFFERENT systems = OPPOSITE outcomes</p>
                
                <div class="button-group">
                    <button class="button button-full" onclick="showSection('setup')">Start Simulation ‚Üí</button>
                </div>
            </div>
            
            <!-- SETUP SECTION -->
            <div id="setup" class="section">
                <h2 style="color: #667eea; margin-bottom: 20px;">Configure Your Simulation</h2>
                
                <div class="control-panel">
                    <div class="control-row">
                        <label class="control-label">DIMENSION 1: Environmental Sensitivity</label>
                        <p style="margin-bottom: 15px; color: #4a5568; font-size: 0.95em;">How responsive is this person's nervous system to environmental input? (5-HTTLPR gene)</p>
                        <div class="radio-grid">
                            <div class="radio-card" onclick="selectSensitivity('orchid')">
                                <input type="radio" name="sensitivity" id="sens-orchid" value="orchid">
                                <label for="sens-orchid">
                                    <div class="radio-icon">üå∏</div>
                                    <div>Orchid</div>
                                    <div style="font-size: 0.85em; color: #718096;">High Sensitivity</div>
                                    <div style="font-size: 0.75em; color: #a0aec0; margin-top: 5px;">Responds strongly to both good and bad</div>
                                </label>
                            </div>
                            <div class="radio-card" onclick="selectSensitivity('tulip')">
                                <input type="radio" name="sensitivity" id="sens-tulip" value="tulip">
                                <label for="sens-tulip">
                                    <div class="radio-icon">üå∑</div>
                                    <div>Tulip</div>
                                    <div style="font-size: 0.85em; color: #718096;">Balanced</div>
                                    <div style="font-size: 0.75em; color: #a0aec0; margin-top: 5px;">Moderate responsiveness</div>
                                </label>
                            </div>
                            <div class="radio-card" onclick="selectSensitivity('dandelion')">
                                <input type="radio" name="sensitivity" id="sens-dandelion" value="dandelion">
                                <label for="sens-dandelion">
                                    <div class="radio-icon">üåº</div>
                                    <div>Dandelion</div>
                                    <div style="font-size: 0.85em; color: #718096;">Low Sensitivity</div>
                                    <div style="font-size: 0.75em; color: #a0aec0; margin-top: 5px;">Robust, masks harm</div>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-row">
                        <label class="control-label">DIMENSION 2: Stress Response Style</label>
                        <p style="margin-bottom: 15px; color: #4a5568; font-size: 0.95em;">How does this person's brain perform under pressure vs when calm? (COMT gene)</p>
                        <div class="radio-grid">
                            <div class="radio-card" onclick="selectStress('warrior')">
                                <input type="radio" name="stress" id="stress-warrior" value="warrior">
                                <label for="stress-warrior">
                                    <div class="radio-icon">üõ°Ô∏è</div>
                                    <div>Warrior</div>
                                    <div style="font-size: 0.85em; color: #718096;">Good Under Pressure</div>
                                    <div style="font-size: 0.75em; color: #a0aec0; margin-top: 5px;">Thrives in crisis mode</div>
                                </label>
                            </div>
                            <div class="radio-card" onclick="selectStress('balanced')">
                                <input type="radio" name="stress" id="stress-balanced" value="balanced">
                                <label for="stress-balanced">
                                    <div class="radio-icon">‚öñÔ∏è</div>
                                    <div>Balanced</div>
                                    <div style="font-size: 0.85em; color: #718096;">Moderate</div>
                                    <div style="font-size: 0.75em; color: #a0aec0; margin-top: 5px;">Functional in both contexts</div>
                                </label>
                            </div>
                            <div class="radio-card" onclick="selectStress('worrier')">
                                <input type="radio" name="stress" id="stress-worrier" value="worrier">
                                <label for="stress-worrier">
                                    <div class="radio-icon">üîç</div>
                                    <div>Worrier</div>
                                    <div style="font-size: 0.85em; color: #718096;">Best When Calm</div>
                                    <div style="font-size: 0.75em; color: #a0aec0; margin-top: 5px;">Superior analysis, needs stability</div>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-row">
                        <label class="control-label">Institutional Environment:</label>
                        <p style="margin-bottom: 15px; color: #4a5568; font-size: 0.95em;">What kind of system will this person work/study in?</p>
                        <div class="radio-grid">
                            <div class="radio-card" onclick="selectEnvironment('extractive')">
                                <input type="radio" name="environment" id="env-extractive" value="extractive">
                                <label for="env-extractive">
                                    <div class="radio-icon">‚õìÔ∏è</div>
                                    <div>Extractive</div>
                                    <div style="font-size: 0.85em; color: #718096;">No autonomy, algorithmic pace</div>
                                    <div style="font-size: 0.75em; color: #a0aec0; margin-top: 5px;">Surveillance, values-misaligned, extractive</div>
                                </label>
                            </div>
                            <div class="radio-card" onclick="selectEnvironment('metabolic')">
                                <input type="radio" name="environment" id="env-metabolic" value="metabolic">
                                <label for="env-metabolic">
                                    <div class="radio-icon">üå±</div>
                                    <div>Metabolic</div>
                                    <div style="font-size: 0.85em; color: #718096;">Autonomy, values-aligned</div>
                                    <div style="font-size: 0.75em; color: #a0aec0; margin-top: 5px;">Supportive, human-centered, sustainable</div>
                                </label>
                            </div>
                        </div>
                        <div style="margin-top: 15px; padding: 15px; background: white; border-radius: 6px; font-size: 0.9em; color: #4a5568;">
                            <p><strong>Extractive Examples:</strong> Amazon warehouse, gig economy platform, for-profit nursing home chain, high-stakes standardized testing school</p>
                            <p style="margin-top: 8px;"><strong>Metabolic Examples:</strong> Worker-owned cooperative, university with tenure protections, Patagonia-style company, supportive healthcare system</p>
                        </div>
                    </div>
                    
                    <div class="control-row">
                        <label class="control-label">BioBond Level: <span id="biobond-display">50%</span></label>
                        <div class="slider-container">
                            <input type="range" id="biobond-slider" min="0" max="100" value="50" oninput="updateBioBondDisplay()">
                            <div class="slider-labels">
                                <span>0% (None)</span>
                                <span>50% (Moderate)</span>
                                <span>100% (Perfect)</span>
                            </div>
                        </div>
                        <div style="margin-top: 15px; padding: 15px; background: white; border-radius: 6px; font-size: 0.9em; color: #4a5568;">
                            <strong>BioBond includes:</strong> Sleep hygiene, sensory gating, exercise, social support, moral debt metabolization, threat-challenge reframing
                        </div>
                    </div>
                </div>
                
                <div class="info-box">
                    <h3>üí° Experiment Ideas</h3>
                    <p><strong>Experiment 1:</strong> Orchid in extractive (0% BioBond) vs orchid in metabolic (0% BioBond)</p>
                    <p><strong>Experiment 2:</strong> Orchid vs dandelion in SAME extractive environment</p>
                    <p><strong>Experiment 3:</strong> Extractive with 70% BioBond vs metabolic with 30% BioBond</p>
                </div>
                
                <div class="button-group">
                    <button class="button button-secondary" onclick="showSection('welcome')">‚Üê Back</button>
                    <button class="button" onclick="startSimulation()">Run Simulation ‚Üí</button>
                    <button class="button button-secondary" onclick="startComparison()">Compare Two Scenarios</button>
                </div>
            </div>
            
            <!-- SIMULATION SECTION -->
            <div id="simulation" class="section">
                <div class="simulation-container">
                    <div class="sim-header">
                        <h2 id="sim-title">Simulation Running...</h2>
                        <div id="sim-description" style="color: #718096; margin-top: 10px;"></div>
                    </div>
                    
                    <div class="week-display" id="week-display">Week 0</div>
                    
                    <div class="play-controls">
                        <button class="play-button" id="play-button" onclick="togglePlay()">‚ñ∂Ô∏è</button>
                        <div style="margin-top: 15px;">
                            <button class="button button-secondary" onclick="resetSimulation()" style="padding: 10px 30px; font-size: 1em;">Reset</button>
                        </div>
                    </div>
                    
                    <div class="charts-container">
                        <div class="chart-wrapper">
                            <div class="chart-title">Glucocorticoid Load (L_GC)</div>
                            <canvas id="chart-lgc"></canvas>
                            <div style="text-align: center; margin-top: 10px; font-size: 0.85em; color: #718096;">
                                Stress hormone burden
                            </div>
                        </div>
                        
                        <div class="chart-wrapper">
                            <div class="chart-title">PFC Capacity (C_PFC)</div>
                            <canvas id="chart-cpfc"></canvas>
                            <div style="text-align: center; margin-top: 10px; font-size: 0.85em; color: #718096;">
                                Ethical reasoning ability
                            </div>
                        </div>
                        
                        <div class="chart-wrapper">
                            <div class="chart-title">Moral Debt (MFP)</div>
                            <canvas id="chart-mfp"></canvas>
                            <div style="text-align: center; margin-top: 10px; font-size: 0.85em; color: #718096;">
                                Values violation accumulation
                            </div>
                        </div>
                        
                        <div class="chart-wrapper">
                            <div class="chart-title">Functional Capacity (FHRI)</div>
                            <canvas id="chart-fhri"></canvas>
                            <div id="fhri-status" style="text-align: center; margin-top: 10px; font-size: 0.85em;"></div>
                        </div>
                    </div>
                    
                    <div class="timeline-events">
                        <h3 style="margin-bottom: 15px; color: #667eea;">Timeline of Events</h3>
                        <div id="timeline-content">
                            <div class="timeline-event milestone">
                                <span class="event-week">Week 0:</span> Simulation begins
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="final-summary" style="display: none; margin-top: 30px;">
                    <!-- Will be populated by JavaScript -->
                </div>
                
                <div class="button-group">
                    <button class="button button-secondary" onclick="showSection('setup')">‚Üê New Simulation</button>
                    <button class="button" onclick="startComparison()">Compare Scenarios</button>
                </div>
            </div>
            
            <!-- COMPARISON SECTION -->
            <div id="comparison" class="section">
                <h2 style="color: #667eea; margin-bottom: 20px; text-align: center;">Side-by-Side Comparison</h2>
                
                <p style="text-align: center; margin-bottom: 30px; color: #718096;">Configure two scenarios and watch them run simultaneously</p>
                
                <div class="comparison-container" id="comparison-setup">
                    <div class="comparison-panel left">
                        <div class="panel-header left">SCENARIO A</div>
                        <!-- Setup controls for Scenario A -->
                        <div id="scenario-a-controls">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <div class="comparison-panel right">
                        <div class="panel-header right">SCENARIO B</div>
                        <!-- Setup controls for Scenario B -->
                        <div id="scenario-b-controls">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
                
                <div class="button-group" style="justify-content: center;">
                    <button class="button button-secondary" onclick="showSection('setup')">‚Üê Back</button>
                    <button class="button" onclick="runComparison()">Run Comparison ‚Üí</button>
                </div>
                
                <div id="comparison-results" style="display: none; margin-top: 30px;">
                    <!-- Will be populated after comparison runs -->
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <script>
        // ===================================================================
        // BIOLOGY SIMULATOR - JAVASCRIPT
        // ===================================================================
        
        // State Management
        let config = {
            sensitivity: null,
            stress: null,
            environment: null,
            biobond: 50
        };
        
        let simulation = {
            week: 0,
            data: {
                lgc: [0.4],
                cpfc: [0.85],
                mfp: [0],
                fhri: [78]
            },
            events: [],
            isRunning: false,
            intervalId: null
        };
        
        let charts = {};
        
        // Section Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            window.scrollTo(0, 0);
        }
        
        // Setup Controls
        function selectSensitivity(type) {
            config.sensitivity = type;
            document.querySelectorAll('.radio-card').forEach(card => {
                if (card.querySelector(`#sens-${type}`)) {
                    card.classList.add('selected');
                } else if (card.querySelector('[name="sensitivity"]')) {
                    card.classList.remove('selected');
                }
            });
            document.getElementById(`sens-${type}`).checked = true;
        }
        
        function selectStress(type) {
            config.stress = type;
            document.querySelectorAll('.radio-card').forEach(card => {
                if (card.querySelector(`#stress-${type}`)) {
                    card.classList.add('selected');
                } else if (card.querySelector('[name="stress"]')) {
                    card.classList.remove('selected');
                }
            });
            document.getElementById(`stress-${type}`).checked = true;
        }
        
        function selectEnvironment(type) {
            config.environment = type;
            document.querySelectorAll('.radio-card').forEach(card => {
                if (card.querySelector(`#env-${type}`)) {
                    card.classList.add('selected');
                } else if (card.querySelector('[name="environment"]')) {
                    card.classList.remove('selected');
                }
            });
            document.getElementById(`env-${type}`).checked = true;
        }
        
        function updateBioBondDisplay() {
            const value = document.getElementById('biobond-slider').value;
            config.biobond = parseInt(value);
            document.getElementById('biobond-display').textContent = value + '%';
        }
        
        // Start Simulation
        function startSimulation() {
            if (!config.sensitivity || !config.stress || !config.environment) {
                alert('Please select all options before starting.');
                return;
            }
            
            initializeSimulation();
            createCharts();
            showSection('simulation');
        }
        
        function initializeSimulation() {
            simulation.week = 0;
            simulation.data = {
                lgc: [calculateInitialLGC()],
                cpfc: [0.85],
                mfp: [0],
                fhri: [78]
            };
            simulation.events = [{
                week: 0,
                type: 'milestone',
                text: 'Simulation begins'
            }];
            simulation.isRunning = false;
            
            // Update display
            const sensLabel = config.sensitivity.charAt(0).toUpperCase() + config.sensitivity.slice(1);
            const stressLabel = config.stress.charAt(0).toUpperCase() + config.stress.slice(1);
            const envLabel = config.environment.charAt(0).toUpperCase() + config.environment.slice(1);
            
            document.getElementById('sim-title').textContent = `${sensLabel}-${stressLabel} in ${envLabel} Institution`;
            document.getElementById('sim-description').textContent = `BioBond Level: ${config.biobond}%`;
            document.getElementById('week-display').textContent = 'Week 0';
            document.getElementById('final-summary').style.display = 'none';
        }
        
        function calculateInitialLGC() {
            // Starting glucocorticoid load based on sensitivity
            const baseLGC = {
                'orchid': 0.45,
                'tulip': 0.40,
                'dandelion': 0.35
            };
            return baseLGC[config.sensitivity];
        }
        
        // Create Charts
        function createCharts() {
            const chartConfig = (label, color, max = 1) => ({
                type: 'line',
                data: {
                    labels: Array.from({length: 13}, (_, i) => `W${i}`),
                    datasets: [{
                        label: label,
                        data: [],
                        borderColor: color,
                        backgroundColor: color + '33',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: max,
                            ticks: {
                                callback: function(value) {
                                    return (value * 100).toFixed(0) + (max === 100 ? '' : '%');
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
            
            // Destroy existing charts
            Object.values(charts).forEach(chart => chart.destroy());
            
            // Create new charts
            charts.lgc = new Chart(document.getElementById('chart-lgc'), chartConfig('L_GC', '#f56565'));
            charts.cpfc = new Chart(document.getElementById('chart-cpfc'), chartConfig('C_PFC', '#667eea'));
            charts.mfp = new Chart(document.getElementById('chart-mfp'), chartConfig('MFP', '#ed8936'));
            charts.fhri = new Chart(document.getElementById('chart-fhri'), chartConfig('FHRI', '#48bb78', 100));
            
            updateCharts();
        }
        
        function updateCharts() {
            charts.lgc.data.datasets[0].data = simulation.data.lgc;
            charts.cpfc.data.datasets[0].data = simulation.data.cpfc;
            charts.mfp.data.datasets[0].data = simulation.data.mfp;
            charts.fhri.data.datasets[0].data = simulation.data.fhri;
            
            Object.values(charts).forEach(chart => chart.update());
            
            updateFHRIStatus();
        }
        
        function updateFHRIStatus() {
            const fhri = simulation.data.fhri[simulation.week];
            const statusDiv = document.getElementById('fhri-status');
            
            if (fhri >= 70) {
                statusDiv.innerHTML = '<span style="color: #48bb78; font-weight: 600;">‚úì Thriving</span>';
            } else if (fhri >= 50) {
                statusDiv.innerHTML = '<span style="color: #ed8936; font-weight: 600;">‚ö† Struggling</span>';
            } else {
                statusDiv.innerHTML = '<span style="color: #f56565; font-weight: 600;">üö® Crisis</span>';
            }
        }
        
        // Play Controls
        function togglePlay() {
            if (simulation.isRunning) {
                pauseSimulation();
            } else {
                playSimulation();
            }
        }
        
        function playSimulation() {
            simulation.isRunning = true;
            document.getElementById('play-button').textContent = '‚è∏Ô∏è';
            document.getElementById('play-button').classList.add('playing');
            
            simulation.intervalId = setInterval(() => {
                advanceWeek();
                if (simulation.week >= 12) {
                    pauseSimulation();
                    showFinalSummary();
                }
            }, 1000);
        }
        
        function pauseSimulation() {
            simulation.isRunning = false;
            document.getElementById('play-button').textContent = '‚ñ∂Ô∏è';
            document.getElementById('play-button').classList.remove('playing');
            clearInterval(simulation.intervalId);
        }
        
        function resetSimulation() {
            pauseSimulation();
            initializeSimulation();
            createCharts();
            document.getElementById('timeline-content').innerHTML = '<div class="timeline-event milestone"><span class="event-week">Week 0:</span> Simulation begins</div>';
        }
        
        // Advance Week
        function advanceWeek() {
            simulation.week++;
            document.getElementById('week-display').textContent = `Week ${simulation.week}`;
            
            calculateWeekValues();
            updateCharts();
            updateTimeline();
        }
        
        function calculateWeekValues() {
            const week = simulation.week;
            const prevLGC = simulation.data.lgc[week - 1];
            const prevCPFC = simulation.data.cpfc[week - 1];
            const prevMFP = simulation.data.mfp[week - 1];
            
            // Environmental stress input
            const stressInput = config.environment === 'extractive' ? 0.15 : 0.05;
            
            // Sensitivity modifier
            const sensModifier = {
                'orchid': 1.5,
                'tulip': 1.0,
                'dandelion': 0.7
            }[config.sensitivity];
            
            // BioBond effect (reduces stress accumulation)
            const biobondEffect = config.biobond / 100;
            
            // Calculate new L_GC
            const stressAccumulation = stressInput * sensModifier * (1 - biobondEffect * 0.6);
            const recovery = 0.02 * biobondEffect;
            let newLGC = prevLGC + stressAccumulation - recovery;
            newLGC = Math.max(0.1, Math.min(1.0, newLGC));
            
            // Calculate new C_PFC (inversely related to L_GC)
            let newCPFC = 0.95 - (newLGC * 0.8);
            
            // Stress style modifier
            if (config.stress === 'warrior' && config.environment === 'extractive') {
                newCPFC += 0.05; // Warriors perform better under stress initially
            } else if (config.stress === 'worrier' && config.environment === 'extractive') {
                newCPFC -= 0.08; // Worriers struggle more under pressure
            }
            
            newCPFC = Math.max(0.1, Math.min(0.95, newCPFC));
            
            // Calculate Moral Debt (only accumulates in extractive environments)
            let newMFP = prevMFP;
            if (config.environment === 'extractive') {
                const moralDebtAccrual = 0.04 * (1 - biobondEffect * 0.5);
                newMFP += moralDebtAccrual;
            } else {
                // In metabolic environments, can metabolize debt
                newMFP = Math.max(0, newMFP - 0.02);
            }
            newMFP = Math.max(0, Math.min(1.0, newMFP));
            
            // Calculate FHRI (composite)
            const fhriBase = 100 * (0.4 * newCPFC + 0.3 * (1 - newLGC) + 0.3 * (1 - newMFP));
            let newFHRI = fhriBase;
            
            // Environmental quality bonus/penalty
            if (config.environment === 'metabolic') {
                newFHRI += 10;
            } else {
                newFHRI -= 5;
            }
            
            newFHRI = Math.max(10, Math.min(100, newFHRI));
            
            // Store values
            simulation.data.lgc.push(newLGC);
            simulation.data.cpfc.push(newCPFC);
            simulation.data.mfp.push(newMFP);
            simulation.data.fhri.push(newFHRI);
            
            // Check for threshold events
            checkThresholds(week, newLGC, newCPFC, newMFP, newFHRI);
        }
        
        function checkThresholds(week, lgc, cpfc, mfp, fhri) {
            // PFC depletion
            if (cpfc < 0.6 && simulation.data.cpfc[week - 1] >= 0.6) {
                addEvent(week, 'warning', 'PFC capacity below 60% - ethical reasoning compromised');
            }
            
            if (cpfc < 0.4 && simulation.data.cpfc[week - 1] >= 0.4) {
                addEvent(week, 'critical', 'PFC critically depleted - automatic mode only');
            }
            
            // Glucocorticoid load
            if (lgc > 0.7 && simulation.data.lgc[week - 1] <= 0.7) {
                addEvent(week, 'warning', 'Chronic stress levels - hippocampal atrophy beginning');
            }
            
            if (lgc > 0.85 && simulation.data.lgc[week - 1] <= 0.85) {
                addEvent(week, 'critical', 'Severe glucocorticoid burden - biological damage accumulating');
            }
            
            // Moral Debt
            if (mfp > 0.5 && simulation.data.mfp[week - 1] <= 0.5) {
                addEvent(week, 'warning', 'Significant moral debt - identity fragmentation risk');
            }
            
            if (mfp > 0.75 && simulation.data.mfp[week - 1] <= 0.75) {
                addEvent(week, 'critical', 'Severe moral injury risk - PRF integrity compromised');
            }
            
            // FHRI thresholds
            if (fhri < 50 && simulation.data.fhri[week - 1] >= 50) {
                addEvent(week, 'critical', 'FHRI below 50 - burnout zone, exit recommended');
            }
            
            if (fhri < 30 && simulation.data.fhri[week - 1] >= 30) {
                addEvent(week, 'critical', 'FHRI critical - immediate exit required');
            }
            
            // Positive milestones
            if (fhri > 75 && simulation.data.fhri[week - 1] <= 75) {
                addEvent(week, 'milestone', 'FHRI above 75 - thriving zone achieved');
            }
        }
        
        function addEvent(week, type, text) {
            simulation.events.push({ week, type, text });
        }
        
        function updateTimeline() {
            const timeline = document.getElementById('timeline-content');
            timeline.innerHTML = simulation.events.map(event => `
                <div class="timeline-event ${event.type}">
                    <span class="event-week">Week ${event.week}:</span> ${event.text}
                </div>
            `).join('');
            timeline.scrollTop = timeline.scrollHeight;
        }
        
        // Final Summary
        function showFinalSummary() {
            const finalFHRI = simulation.data.fhri[12];
            const finalCPFC = simulation.data.cpfc[12];
            const finalMFP = simulation.data.mfp[12];
            
            let summaryHTML = '<div class="info-box">';
            summaryHTML += '<h3>üìä 12-Week Simulation Complete</h3>';
            summaryHTML += `<p><strong>Final Status:</strong></p>`;
            summaryHTML += `<ul style="margin-left: 20px;">`;
            summaryHTML += `<li>FHRI: ${finalFHRI.toFixed(1)} ${finalFHRI >= 70 ? '(Thriving ‚úì)' : finalFHRI >= 50 ? '(Struggling ‚ö†Ô∏è)' : '(Crisis üö®)'}</li>`;
            summaryHTML += `<li>C_PFC: ${(finalCPFC * 100).toFixed(0)}% ${finalCPFC >= 0.6 ? '(Functional ‚úì)' : '(Depleted üö®)'}</li>`;
            summaryHTML += `<li>Moral Debt: ${(finalMFP * 100).toFixed(0)}% ${finalMFP < 0.5 ? '(Manageable ‚úì)' : '(Severe ‚ö†Ô∏è)'}</li>`;
            summaryHTML += `</ul>`;
            
            // Interpretation
            summaryHTML += '<p style="margin-top: 15px;"><strong>What This Means:</strong></p>';
            
            if (config.environment === 'extractive' && finalFHRI < 60) {
                summaryHTML += '<p>Even with ' + config.biobond + '% BioBond, this extractive environment produces dysfunction. ';
                summaryHTML += '<strong>Personal effort cannot compensate for toxic institutional design.</strong> ';
                if (config.sensitivity === 'orchid') {
                    summaryHTML += 'As an orchid, early exit (Week 8-10) would be PROTECTIVE - your visible collapse is a gift preventing deeper damage.';
                } else if (config.sensitivity === 'dandelion') {
                    summaryHTML += 'As a dandelion, you appear "fine" longer but are accumulating SILENT damage (cardiovascular, epigenetic). Your endurance enables exploitation.';
                }
                summaryHTML += '</p>';
            } else if (config.environment === 'metabolic' && finalFHRI > 70) {
                summaryHTML += '<p>With ' + config.biobond + '% BioBond in a metabolic environment, you THRIVE. ';
                summaryHTML += '<strong>Institutional design amplifies human flourishing.</strong> ';
                if (config.sensitivity === 'orchid') {
                    summaryHTML += 'As an orchid, you bloom spectacularly when properly supported - the same sensitivity that makes you vulnerable enables exceptional performance.';
                }
                summaryHTML += '</p>';
            }
            
            summaryHTML += '</div>';
            
            document.getElementById('final-summary').innerHTML = summaryHTML;
            document.getElementById('final-summary').style.display = 'block';
        }
        
        // Comparison Mode
        function startComparison() {
            // Implement comparison mode setup
            showSection('comparison');
            setupComparisonControls();
        }
        
        function setupComparisonControls() {
            // This would create two sets of controls for side-by-side comparison
            // For now, simplified version
            alert('Comparison mode: Configure two scenarios and run them side-by-side. Full implementation would show two parallel simulations.');
        }
        
        function runComparison() {
            alert('Running comparison... This would show two simulations running simultaneously with side-by-side charts.');
        }
    </script>
</body>
</html>
