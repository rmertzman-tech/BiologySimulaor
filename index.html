<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biology Simulator - Enhanced V4</title>
    
    <style>
        /* Previous styles maintained... adding new components */
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            line-height: 1.6;
            color: #2d3748;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: #667eea;
            color: white;
            padding: 8px;
            text-decoration: none;
            z-index: 100;
        }
        
        .skip-link:focus {
            top: 0;
        }
        
        *:focus {
            outline: 3px solid #667eea;
            outline-offset: 2px;
        }
        
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.95;
        }
        
        .content {
            padding: 40px 30px;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            white-space: nowrap;
            border-width: 0;
        }
        
        .info-box {
            background: #f7fafc;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 25px 0;
            border-radius: 4px;
        }
        
        .info-box.warning {
            border-left-color: #f56565;
            background: #fff5f5;
        }
        
        .info-box.success {
            border-left-color: #48bb78;
            background: #f0fff4;
        }
        
        .info-box h3 {
            margin-bottom: 10px;
            color: #2d3748;
        }
        
        /* NEW: Symptom Log Styles */
        .symptom-log {
            background: #fffaf0;
            border: 2px solid #ed8936;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            animation: pulse 2s ease-in-out;
        }
        
        .symptom-log.critical {
            background: #fff5f5;
            border-color: #f56565;
            animation: pulse 1s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(237, 137, 54, 0.4); }
            50% { box-shadow: 0 0 0 10px rgba(237, 137, 54, 0); }
        }
        
        .symptom-log h4 {
            color: #c05621;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .symptom-log.critical h4 {
            color: #c53030;
        }
        
        .symptom-log ul {
            margin-left: 20px;
            list-style: none;
        }
        
        .symptom-log li {
            margin: 8px 0;
            padding-left: 20px;
            position: relative;
        }
        
        .symptom-log li:before {
            content: "‚ö†Ô∏è";
            position: absolute;
            left: 0;
        }
        
        .symptom-log.critical li:before {
            content: "üö®";
        }
        
        /* NEW: Hidden Damage Indicator */
        .hidden-damage-alert {
            background: linear-gradient(135deg, #fc8181 0%, #c53030 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(197, 48, 48, 0.3);
        }
        
        .hidden-damage-alert h3 {
            color: white;
            margin-bottom: 10px;
        }
        
        .damage-metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.2);
            padding: 12px;
            border-radius: 6px;
            margin: 10px 0;
        }
        
        .damage-metric-label {
            font-weight: 600;
        }
        
        .damage-metric-value {
            font-size: 1.5em;
            font-weight: 700;
        }
        
        /* Control Panel */
        .control-panel {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .control-row {
            margin-bottom: 25px;
        }
        
        .control-row:last-child {
            margin-bottom: 0;
        }
        
        .control-label {
            font-weight: 600;
            margin-bottom: 10px;
            display: block;
            color: #2d3748;
        }
        
        .radio-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }
        
        .radio-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .radio-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }
        
        .radio-card:focus-within {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
        }
        
        .radio-card input[type="radio"] {
            position: absolute;
            opacity: 0;
        }
        
        .radio-card input[type="radio"]:checked + label {
            color: #667eea;
            font-weight: 600;
        }
        
        .radio-card.selected {
            border-color: #667eea;
            background: #edf2f7;
        }
        
        .radio-card label {
            cursor: pointer;
            display: block;
            font-weight: 500;
        }
        
        .radio-icon {
            font-size: 2em;
            margin-bottom: 8px;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }
        
        .button {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
        }
        
        .button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .button:focus {
            outline: 3px solid #667eea;
            outline-offset: 3px;
        }
        
        .button-secondary {
            background: #718096;
        }
        
        .button-secondary:hover {
            background: #4a5568;
        }
        
        .button-full {
            width: 100%;
            margin-top: 10px;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        /* NEW: Choice Point Modal */
        .choice-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .choice-modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
        }
        
        .choice-modal h2 {
            color: #667eea;
            margin-bottom: 20px;
        }
        
        .choice-scenario {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .choice-scenario h3 {
            color: #2d3748;
            margin-bottom: 10px;
        }
        
        .choice-consequences {
            margin-top: 10px;
            padding: 10px;
            background: rgba(237, 137, 54, 0.1);
            border-radius: 4px;
        }
        
        .choice-consequences.bad {
            background: rgba(245, 101, 101, 0.1);
        }
        
        .choice-button {
            width: 100%;
            margin-top: 10px;
            padding: 15px;
            font-size: 1.1em;
        }
        
        /* Comparison Container */
        .comparison-split {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }
        
        .comparison-side {
            background: #f7fafc;
            border-radius: 8px;
            padding: 20px;
            border: 3px solid #e2e8f0;
        }
        
        .comparison-side.scenario-a {
            border-color: #667eea;
        }
        
        .comparison-side.scenario-b {
            border-color: #48bb78;
        }
        
        .scenario-header {
            text-align: center;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-weight: 700;
            font-size: 1.2em;
            color: white;
        }
        
        .scenario-header.scenario-a {
            background: #667eea;
        }
        
        .scenario-header.scenario-b {
            background: #48bb78;
        }
        
        .chart-wrapper {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .chart-title {
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
            color: #2d3748;
        }
        
        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: #f7fafc;
            border-radius: 4px;
        }
        
        .metric-label {
            font-weight: 600;
            color: #4a5568;
        }
        
        .metric-value {
            font-size: 1.3em;
            font-weight: 700;
        }
        
        .metric-value.good {
            color: #48bb78;
        }
        
        .metric-value.warning {
            color: #ed8936;
        }
        
        .metric-value.critical {
            color: #f56565;
        }
        
        /* NEW: Visual Chart Bars */
        .chart-container {
            height: 150px;
            display: flex;
            align-items: flex-end;
            gap: 3px;
            padding: 10px 0;
            border-bottom: 2px solid #cbd5e0;
            margin-top: 15px;
            background: #f7fafc;
            border-radius: 4px;
            padding: 10px;
        }
        
        .chart-bar {
            flex: 1;
            background: #667eea;
            border-radius: 4px 4px 0 0;
            transition: height 0.3s ease;
            position: relative;
            min-width: 8px;
        }
        
        .chart-bar:hover::after {
            content: attr(data-value);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #2d3748;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            white-space: nowrap;
            margin-bottom: 4px;
        }
        
        .chart-bar.healthy { background: #48bb78; }
        .chart-bar.warning { background: #ed8936; }
        .chart-bar.critical { background: #f56565; }
        
        .play-button {
            font-size: 3em;
            background: #48bb78;
            color: white;
            border: none;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.3);
        }
        
        .play-button:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 30px rgba(72, 187, 120, 0.4);
        }
        
        .play-button.playing {
            background: #ed8936;
            box-shadow: 0 4px 12px rgba(237, 137, 54, 0.3);
            animation: pulse-playing 2s ease-in-out infinite;
        }
        
        .play-button.playing:hover {
            box-shadow: 0 10px 30px rgba(237, 137, 54, 0.4);
        }
        
        @keyframes pulse-playing {
            0%, 100% { box-shadow: 0 4px 12px rgba(237, 137, 54, 0.3); }
            50% { box-shadow: 0 4px 20px rgba(237, 137, 54, 0.6); }
        }
        
        .timeline-event {
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid #e2e8f0;
            background: #f7fafc;
            border-radius: 4px;
        }
        
        .timeline-event.milestone {
            border-left-color: #667eea;
            background: #edf2f7;
        }
        
        .timeline-event.warning {
            border-left-color: #ed8936;
            background: #fffaf0;
        }
        
        .timeline-event.critical {
            border-left-color: #f56565;
            background: #fff5f5;
        }
        
        .event-week {
            font-weight: 600;
            color: #667eea;
            margin-right: 10px;
        }
        
        @media screen and (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .content {
                padding: 25px 20px;
            }
            
            .comparison-split {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .button {
                width: 100%;
            }
        }
        
        @media (prefers-contrast: high) {
            .button {
                border: 2px solid currentColor;
            }
            
            .radio-card {
                border-width: 3px;
            }
        }
        
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        @media print {
            body {
                background: white;
            }
            
            .app-container {
                box-shadow: none;
            }
            
            .button, .skip-link, .choice-modal {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <div id="sr-announcements" class="sr-only" role="status" aria-live="polite" aria-atomic="true"></div>
    
    <!-- Choice Point Modal (initially hidden) -->
    <div id="choice-modal" class="choice-modal" style="display: none;" role="dialog" aria-labelledby="choice-modal-title" aria-modal="true">
        <div class="choice-modal-content">
            <h2 id="choice-modal-title">‚ö†Ô∏è Week 6: Institutional Pressure</h2>
            
            <div class="info-box warning">
                <p><strong>The Extractive Dilemma:</strong> In extractive institutions, you are FORCED to choose between harms. Neither option is good. This is how toxic systems damage you regardless of your "choices."</p>
                <p style="margin-top: 10px;"><strong>In metabolic institutions, you are NOT FORCED into this dilemma.</strong> Values-aligned design means you don't face these impossible choices.</p>
            </div>
            
            <p style="margin: 20px 0;">Your institution is understaffed. To meet productivity targets, management demands you either:</p>
            
            <div class="choice-scenario">
                <h3>Option A: Comply</h3>
                <p>Cut corners to meet the quota. Ignore safety protocols. Push through despite knowing it's wrong.</p>
                <div class="choice-consequences bad">
                    <strong>Consequences:</strong>
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>Immediate stress reduced (avoid retaliation)</li>
                        <li>Moral Debt accumulates (+0.2 MFP)</li>
                        <li>Identity fragments (PRF damage)</li>
                        <li>Complicity in harm</li>
                    </ul>
                </div>
                <button class="button choice-button" onclick="makeChoice('comply')" aria-label="Choose to comply with institutional demands">Choose to Comply</button>
            </div>
            
            <div class="choice-scenario">
                <h3>Option B: Resist</h3>
                <p>Refuse to cut corners. Maintain standards. Document the unsafe conditions. Speak up.</p>
                <div class="choice-consequences bad">
                    <strong>Consequences:</strong>
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>Retaliation (write-up, job threat)</li>
                        <li>Stress increases sharply (+0.15 L_GC)</li>
                        <li>PRF remains intact (values upheld)</li>
                        <li>But personal cost is high</li>
                    </ul>
                </div>
                <button class="button choice-button button-secondary" onclick="makeChoice('resist')" aria-label="Choose to resist institutional demands">Choose to Resist</button>
            </div>
            
            <div class="info-box">
                <h3>üéØ The Lesson:</h3>
                <p><strong>Both choices harm you in different ways.</strong> This is the signature of extractive institutional design: forcing false dilemmas where you lose either way.</p>
                <p style="margin-top: 10px;"><strong>The problem is not your choice. The problem is being FORCED to make this choice.</strong></p>
                <p style="margin-top: 10px;"><strong>Metabolic institutions don't put you in this position.</strong> They provide resources, autonomy, and values alignment so you're not forced between your integrity and your survival.</p>
            </div>
        </div>
    </div>
    
    <div class="app-container">
        <header class="header" role="banner">
            <h1>üß™ Biology Simulator - Enhanced</h1>
            <p>See Your Brain Under Stress - Now with Hidden Damage Tracking</p>
        </header>
        
        <main class="content" id="main-content" role="main">
            <!-- Welcome section would go here - keeping brief for length -->
            
            <!-- COMPARISON SETUP SECTION -->
            <section id="comparison-setup" class="section active" aria-labelledby="comparison-heading">
                <h2 id="comparison-heading" style="color: #667eea; margin-bottom: 20px; text-align: center;">Side-by-Side Comparison</h2>
                
                <p style="text-align: center; margin-bottom: 20px; color: #718096;">Configure two scenarios and watch them run simultaneously</p>
                
                <div class="info-box">
                    <h3>üî¨ New Feature: Silent Damage Tracking</h3>
                    <p><strong>Dandelions (low sensitivity) now tracked for hidden costs:</strong></p>
                    <ul style="margin-left: 25px; margin-top: 10px;">
                        <li><strong>GrimAge Biological Aging:</strong> Epigenetic clock acceleration</li>
                        <li><strong>Cardiovascular Risk:</strong> Silent arterial damage accumulation</li>
                        <li><strong>The Dangerous Reality:</strong> FHRI 55 (appearing "functional") + 1.8 years biological aging = WORSE total harm than orchid's visible collapse at FHRI 35</li>
                    </ul>
                    <p style="margin-top: 10px; font-weight: bold;">High turnover (orchids fleeing) is the WARNING SIGN. Low turnover (dandelions enduring) masks catastrophic damage.</p>
                </div>
                
                <div class="comparison-split">
                    <div class="comparison-side scenario-a" role="region" aria-labelledby="scenario-a-heading">
                        <h3 class="scenario-header scenario-a" id="scenario-a-heading">SCENARIO A</h3>
                        
                        <form aria-label="Scenario A configuration">
                            <fieldset class="control-row">
                                <legend style="font-weight: 600; margin-bottom: 10px;">Sensitivity:</legend>
                                <select id="comp-sens-a" style="width: 100%; padding: 10px; border-radius: 4px; border: 2px solid #e2e8f0; font-size: 1em;" aria-label="Scenario A environmental sensitivity">
                                    <option value="">Select...</option>
                                    <option value="orchid">Orchid üå∏ (High Sensitivity)</option>
                                    <option value="tulip">Tulip üå∑ (Balanced)</option>
                                    <option value="dandelion">Dandelion üåº (Low Sensitivity)</option>
                                </select>
                            </fieldset>
                            
                            <fieldset class="control-row">
                                <legend style="font-weight: 600; margin-bottom: 10px;">Stress Style:</legend>
                                <select id="comp-stress-a" style="width: 100%; padding: 10px; border-radius: 4px; border: 2px solid #e2e8f0; font-size: 1em;" aria-label="Scenario A stress response style">
                                    <option value="">Select...</option>
                                    <option value="warrior">Warrior üõ°Ô∏è (Good Under Pressure)</option>
                                    <option value="balanced">Balanced ‚öñÔ∏è (Moderate)</option>
                                    <option value="worrier">Worrier üîç (Best When Calm)</option>
                                </select>
                            </fieldset>
                            
                            <fieldset class="control-row">
                                <legend style="font-weight: 600; margin-bottom: 10px;">Environment:</legend>
                                <select id="comp-env-a" style="width: 100%; padding: 10px; border-radius: 4px; border: 2px solid #e2e8f0; font-size: 1em;" aria-label="Scenario A institutional environment">
                                    <option value="">Select...</option>
                                    <option value="extractive">Extractive ‚õìÔ∏è (No Autonomy)</option>
                                    <option value="metabolic">Metabolic üå± (Values-Aligned)</option>
                                </select>
                            </fieldset>
                            
                            <div class="control-row">
                                <label for="comp-biobond-a" style="font-weight: 600; margin-bottom: 10px; display: block;">BioBond: <span id="comp-biobond-display-a" aria-live="polite">50%</span></label>
                                <input 
                                    type="range" 
                                    id="comp-biobond-a" 
                                    min="0" 
                                    max="100" 
                                    value="50" 
                                    oninput="document.getElementById('comp-biobond-display-a').textContent = this.value + '%'"
                                    style="width: 100%;"
                                    aria-label="Scenario A BioBond level"
                                    aria-valuemin="0"
                                    aria-valuemax="100"
                                    aria-valuenow="50">
                                <div style="margin-top: 10px;">
                                    <button type="button" class="button button-secondary" style="padding: 8px 15px; font-size: 0.9em; margin-right: 5px;" onclick="setBiobond('a', 10)">Crisis (10%)</button>
                                    <button type="button" class="button button-secondary" style="padding: 8px 15px; font-size: 0.9em; margin-right: 5px;" onclick="setBiobond('a', 40)">Average (40%)</button>
                                    <button type="button" class="button button-secondary" style="padding: 8px 15px; font-size: 0.9em;" onclick="setBiobond('a', 80)">Optimized (80%)</button>
                                </div>
                            </div>
                        </form>
                    </div>
                    
                    <div class="comparison-side scenario-b" role="region" aria-labelledby="scenario-b-heading">
                        <h3 class="scenario-header scenario-b" id="scenario-b-heading">SCENARIO B</h3>
                        
                        <form aria-label="Scenario B configuration">
                            <fieldset class="control-row">
                                <legend style="font-weight: 600; margin-bottom: 10px;">Sensitivity:</legend>
                                <select id="comp-sens-b" style="width: 100%; padding: 10px; border-radius: 4px; border: 2px solid #e2e8f0; font-size: 1em;" aria-label="Scenario B environmental sensitivity">
                                    <option value="">Select...</option>
                                    <option value="orchid">Orchid üå∏ (High Sensitivity)</option>
                                    <option value="tulip">Tulip üå∑ (Balanced)</option>
                                    <option value="dandelion">Dandelion üåº (Low Sensitivity)</option>
                                </select>
                            </fieldset>
                            
                            <fieldset class="control-row">
                                <legend style="font-weight: 600; margin-bottom: 10px;">Stress Style:</legend>
                                <select id="comp-stress-b" style="width: 100%; padding: 10px; border-radius: 4px; border: 2px solid #e2e8f0; font-size: 1em;" aria-label="Scenario B stress response style">
                                    <option value="">Select...</option>
                                    <option value="warrior">Warrior üõ°Ô∏è (Good Under Pressure)</option>
                                    <option value="balanced">Balanced ‚öñÔ∏è (Moderate)</option>
                                    <option value="worrier">Worrier üîç (Best When Calm)</option>
                                </select>
                            </fieldset>
                            
                            <fieldset class="control-row">
                                <legend style="font-weight: 600; margin-bottom: 10px;">Environment:</legend>
                                <select id="comp-env-b" style="width: 100%; padding: 10px; border-radius: 4px; border: 2px solid #e2e8f0; font-size: 1em;" aria-label="Scenario B institutional environment">
                                    <option value="">Select...</option>
                                    <option value="extractive">Extractive ‚õìÔ∏è (No Autonomy)</option>
                                    <option value="metabolic">Metabolic üå± (Values-Aligned)</option>
                                </select>
                            </fieldset>
                            
                            <div class="control-row">
                                <label for="comp-biobond-b" style="font-weight: 600; margin-bottom: 10px; display: block;">BioBond: <span id="comp-biobond-display-b" aria-live="polite">50%</span></label>
                                <input 
                                    type="range" 
                                    id="comp-biobond-b" 
                                    min="0" 
                                    max="100" 
                                    value="50" 
                                    oninput="document.getElementById('comp-biobond-display-b').textContent = this.value + '%'"
                                    style="width: 100%;"
                                    aria-label="Scenario B BioBond level"
                                    aria-valuemin="0"
                                    aria-valuemax="100"
                                    aria-valuenow="50">
                                <div style="margin-top: 10px;">
                                    <button type="button" class="button button-secondary" style="padding: 8px 15px; font-size: 0.9em; margin-right: 5px;" onclick="setBiobond('b', 10)">Crisis (10%)</button>
                                    <button type="button" class="button button-secondary" style="padding: 8px 15px; font-size: 0.9em; margin-right: 5px;" onclick="setBiobond('b', 40)">Average (40%)</button>
                                    <button type="button" class="button button-secondary" style="padding: 8px 15px; font-size: 0.9em;" onclick="setBiobond('b', 80)">Optimized (80%)</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                
                <nav aria-label="Comparison actions">
                    <div class="button-group" style="justify-content: center;">
                        <button class="button" onclick="runComparison()" aria-label="Run side-by-side comparison">Run Comparison ‚Üí</button>
                    </div>
                </nav>
            </section>
            
            <!-- COMPARISON RESULTS SECTION -->
            <section id="comparison-results" class="section" aria-labelledby="comparison-results-heading">
                <h2 id="comparison-results-heading" style="color: #667eea; margin-bottom: 20px; text-align: center;">Comparison Results</h2>
                
                <div style="text-align: center; margin-bottom: 30px;">
                    <p style="font-size: 1.2em; font-weight: 600; margin-bottom: 10px;">Month <span id="comp-week-display">0</span> of 12</p>
                    <p style="font-size: 0.95em; color: #718096; margin-bottom: 15px;">One year timeline - matches real-world progression</p>
                    
                    <!-- Play Controls -->
                    <div style="margin-bottom: 20px;">
                        <button class="play-button" id="comp-play-button" onclick="toggleComparisonPlay()" aria-label="Play or pause comparison simulation">‚ñ∂Ô∏è</button>
                        <button class="button" onclick="stepForward()" style="padding: 15px 30px; font-size: 1.1em; margin-left: 15px;" aria-label="Advance one month">Next Month ‚Üí</button>
                    </div>
                    
                    <!-- Speed Control -->
                    <div style="max-width: 400px; margin: 0 auto 20px; padding: 20px; background: #f7fafc; border-radius: 8px; border: 2px solid #e2e8f0;">
                        <label for="speed-control" style="font-weight: 600; margin-bottom: 10px; display: block;">
                            Simulation Speed: <span id="speed-display" aria-live="polite">3 seconds per month</span>
                        </label>
                        <input 
                            type="range" 
                            id="speed-control" 
                            min="1" 
                            max="5" 
                            value="3" 
                            step="1"
                            oninput="updateSpeed()"
                            style="width: 100%;"
                            aria-label="Simulation speed from 1 to 5 seconds per month"
                            aria-valuemin="1"
                            aria-valuemax="5"
                            aria-valuenow="3">
                        <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 0.85em; color: #718096;">
                            <span>Fast (1s)</span>
                            <span>Moderate (3s)</span>
                            <span>Slow (5s)</span>
                        </div>
                        <p style="margin-top: 10px; font-size: 0.9em; color: #4a5568; text-align: left;">
                            <strong>Tip:</strong> Use slower speeds to read narratives and symptom logs. Use "Next Month" button to examine each month carefully.
                        </p>
                    </div>
                    
                    <div style="margin-top: 15px;">
                        <button class="button button-secondary" onclick="resetComparison()" style="padding: 10px 30px; font-size: 1em;" aria-label="Reset comparison simulation">Reset</button>
                    </div>
                </div>
                
                <div class="comparison-split">
                    <!-- Scenario A Results -->
                    <div class="comparison-side scenario-a" role="region" aria-labelledby="results-a-heading">
                        <h3 class="scenario-header scenario-a" id="results-a-heading">SCENARIO A</h3>
                        <p id="comp-description-a" style="text-align: center; margin-bottom: 20px; font-size: 0.95em; color: #4a5568;"></p>
                        
                        <!-- NEW: Symptom Log A -->
                        <div id="symptom-log-a" style="display: none;"></div>
                        
                        <!-- NEW: Monthly Narrative Display -->
                        <div id="narrative-a" style="display: none; margin-top: 15px; padding: 15px; background: #f0f9ff; border-left: 4px solid #3b82f6; border-radius: 4px;">
                            <h4 style="font-size: 1em; margin: 0 0 10px 0; color: #1e40af;">üìñ This Month's Reality</h4>
                            <div id="narrative-content-a" style="font-size: 0.95em; line-height: 1.6; color: #374151;"></div>
                        </div>
                        
                        <div class="chart-wrapper">
                            <div class="metric-row">
                                <span class="metric-label">FHRI:</span>
                                <span id="comp-fhri-a" class="metric-value good" aria-label="Scenario A functional capacity">78</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">C_PFC:</span>
                                <span id="comp-cpfc-a" class="metric-value good" aria-label="Scenario A prefrontal cortex capacity">85%</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">L_GC:</span>
                                <span id="comp-lgc-a" class="metric-value good" aria-label="Scenario A glucocorticoid load">40%</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">MFP:</span>
                                <span id="comp-mfp-a" class="metric-value good" aria-label="Scenario A moral debt">0%</span>
                            </div>
                            
                            <!-- NEW: Visual Chart A -->
                            <div style="margin-top: 20px;">
                                <h4 style="font-size: 0.9em; text-align: center; color: #718096; margin-bottom: 10px;">FHRI Trajectory</h4>
                                <div id="chart-a" class="chart-container" role="img" aria-label="Bar chart showing FHRI levels over 12 weeks"></div>
                            </div>
                        </div>
                        
                        <!-- NEW: Hidden Damage Alert A -->
                        <div id="hidden-damage-a" style="display: none;"></div>
                        
                        <div id="comp-timeline-a" style="margin-top: 20px; padding: 15px; background: white; border-radius: 6px; max-height: 200px; overflow-y: auto;" role="log" aria-label="Scenario A timeline of events">
                            <p style="font-weight: 600; margin-bottom: 10px;">Timeline:</p>
                            <div class="timeline-event milestone">
                                <span class="event-week">Week 0:</span> Simulation begins
                            </div>
                        </div>
                        
                        <!-- NEW: Sapolsky Multi-Level Biological Changes Chart -->
                        <div style="margin-top: 20px; padding: 15px; background: #fefce8; border-radius: 6px; border: 2px solid #eab308;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; cursor: pointer;" onclick="toggleSapolsky('a')" role="button" tabindex="0" aria-label="Toggle biological changes detail view">
                                <h4 style="margin: 0; font-size: 1em; color: #854d0e;">
                                    üß† Biological Changes - Multi-Level Analysis
                                    <span style="font-size: 0.85em; color: #a16207; margin-left: 8px;">(Sapolsky Framework)</span>
                                </h4>
                                <span id="sapolsky-toggle-a" style="font-size: 1.2em; color: #854d0e;">‚ñº</span>
                            </div>
                            <div id="sapolsky-content-a" style="display: none;"></div>
                        </div>
                    </div>
                    
                    <!-- Scenario B Results -->
                    <div class="comparison-side scenario-b" role="region" aria-labelledby="results-b-heading">
                        <h3 class="scenario-header scenario-b" id="results-b-heading">SCENARIO B</h3>
                        <p id="comp-description-b" style="text-align: center; margin-bottom: 20px; font-size: 0.95em; color: #4a5568;"></p>
                        
                        <!-- NEW: Symptom Log B -->
                        <div id="symptom-log-b" style="display: none;"></div>
                        
                        <!-- NEW: Monthly Narrative Display -->
                        <div id="narrative-b" style="display: none; margin-top: 15px; padding: 15px; background: #f0f9ff; border-left: 4px solid #3b82f6; border-radius: 4px;">
                            <h4 style="font-size: 1em; margin: 0 0 10px 0; color: #1e40af;">üìñ This Month's Reality</h4>
                            <div id="narrative-content-b" style="font-size: 0.95em; line-height: 1.6; color: #374151;"></div>
                        </div>
                        
                        <div class="chart-wrapper">
                            <div class="metric-row">
                                <span class="metric-label">FHRI:</span>
                                <span id="comp-fhri-b" class="metric-value good" aria-label="Scenario B functional capacity">78</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">C_PFC:</span>
                                <span id="comp-cpfc-b" class="metric-value good" aria-label="Scenario B prefrontal cortex capacity">85%</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">L_GC:</span>
                                <span id="comp-lgc-b" class="metric-value good" aria-label="Scenario B glucocorticoid load">40%</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">MFP:</span>
                                <span id="comp-mfp-b" class="metric-value good" aria-label="Scenario B moral debt">0%</span>
                            </div>
                            
                            <!-- NEW: Visual Chart B -->
                            <div style="margin-top: 20px;">
                                <h4 style="font-size: 0.9em; text-align: center; color: #718096; margin-bottom: 10px;">FHRI Trajectory</h4>
                                <div id="chart-b" class="chart-container" role="img" aria-label="Bar chart showing FHRI levels over 12 weeks"></div>
                            </div>
                        </div>
                        
                        <!-- NEW: Hidden Damage Alert B -->
                        <div id="hidden-damage-b" style="display: none;"></div>
                        
                        <div id="comp-timeline-b" style="margin-top: 20px; padding: 15px; background: white; border-radius: 6px; max-height: 200px; overflow-y: auto;" role="log" aria-label="Scenario B timeline of events">
                            <p style="font-weight: 600; margin-bottom: 10px;">Timeline:</p>
                            <div class="timeline-event milestone">
                                <span class="event-week">Week 0:</span> Simulation begins
                            </div>
                        </div>
                        
                        <!-- NEW: Sapolsky Multi-Level Biological Changes Chart -->
                        <div style="margin-top: 20px; padding: 15px; background: #fefce8; border-radius: 6px; border: 2px solid #eab308;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; cursor: pointer;" onclick="toggleSapolsky('b')" role="button" tabindex="0" aria-label="Toggle biological changes detail view">
                                <h4 style="margin: 0; font-size: 1em; color: #854d0e;">
                                    üß† Biological Changes - Multi-Level Analysis
                                    <span style="font-size: 0.85em; color: #a16207; margin-left: 8px;">(Sapolsky Framework)</span>
                                </h4>
                                <span id="sapolsky-toggle-b" style="font-size: 1.2em; color: #854d0e;">‚ñº</span>
                            </div>
                            <div id="sapolsky-content-b" style="display: none;"></div>
                        </div>
                    </div>
                </div>
                
                <div id="comp-final-summary" style="display: none; margin-top: 30px;" role="region" aria-labelledby="comp-summary-heading">
                    <h3 id="comp-summary-heading" style="color: #667eea; text-align: center; margin-bottom: 20px;">Comparison Summary</h3>
                    <div id="comp-summary-content" class="info-box"></div>
                </div>
                
                <nav aria-label="After comparison actions">
                    <div class="button-group">
                        <button class="button button-secondary" onclick="showSection('comparison-setup')" aria-label="Go back to comparison setup">‚Üê New Comparison</button>
                    </div>
                </nav>
            </section>
        </main>
    </div>
    
    <script>
        // ===================================================================
        // ENHANCED BIOLOGY SIMULATOR V4 - JAVASCRIPT
        // ===================================================================
        
        function announce(message) {
            const announcer = document.getElementById('sr-announcements');
            announcer.textContent = message;
            setTimeout(() => announcer.textContent = '', 1000);
        }
        
        // NEW: Monthly Narrative Data - Shows what's actually happening each month
        const monthlyNarratives = {
            nursing_extractive: {
                1: "Orientation: 4 hours instead of 3 weeks. Assigned 12 patients (recommended: 6). Call lights going unanswered, residents crying out. Beginning to see system isn't designed for safe care.",
                2: "First moral compromise: Resident has Stage 3 pressure ulcer (preventable). Chart shows 'turned q2h' but no time to do it. You document honestly, supervisor edits your note. Identity begins fragmenting.",
                3: "Covering 18 patients across two units. Medication near-miss (caught it barely). Interruptions constant, no protected time. Realizing: it's not IF you make an error, it's WHEN. Sunday night dread intensifying.",
                4: "Family complains their mom's call light unanswered 40 minutes. You: 'I had 12 patients and another was coding.' Management: 'Don't tell families we're understaffed.' Forced to hide system failure.",
                5: "Resident aspirated during lunch (fed too fast, no time for safe feeding). Transferred to hospital. Management pressures you to write 'unexpectedly deteriorated' not 'inadequate staffing contributed.'",
                6: "CRITICAL MONTH: Covering 24 patients, one codes, another falls and fractures hip during CPR. Management demands you sign statement accepting responsibility. FORCED CHOICE: Comply (immediate stress relief, severe moral debt) or Resist (integrity intact, job threatened). Either choice harmful - this is extractive design signature.",
                7: "Physical symptoms severe: Can't remember if you gave 2pm meds. C_PFC too depleted for memory consolidation. Terrified you'll harm someone. Corners being cut automatically now - skipping thorough assessments, charting tasks not done.",
                8: "ORCHID BREAKING POINT: FHRI entering crisis (<50). Panic attacks before shifts. Can't get out of bed. Call in: 'I can't do this anymore.' Supervisor: 'You're abandoning patients.' Exit or collapse. DANDELION ENDURING: FHRI 55-60, appearing functional. Silent damage accumulating: blood pressure rising, sleep architecture disrupted, heart rate variability declining. GrimAge accelerating +0.15 years/month.",
                9: "For those still working: Emotional numbness setting in. 'Just get through the shift' becomes sole goal. Caring about patients feels like luxury you can't afford. Identity: 'I'm not a good nurse anymore.'",
                10: "Relationship strain: Partner says 'You're not the same person.' Emotionally unavailable, snap at loved ones, no energy for life outside work. Work-life balance impossible when work destroys you.",
                11: "Health declining: Weight gain (cortisol ‚Üí abdominal fat), chronic tension headaches, GI issues. Body keeping score even when mind dissociates. For dandelions: all symptoms masked, appearing 'fine.'",
                12: "YEAR END: Orchids exited months ago (protective, recoverable damage). Dandelions still working: FHRI 52-58, appearing functional but GrimAge +1.8 years, CV risk +36%, on trajectory to sudden collapse at 18-24 months. This matches published data: 30% nursing turnover by month 6-12, survivors accumulating hidden damage."
            },
            nursing_metabolic: {
                1: "Structured 12-week orientation with preceptor. Assigned 4-5 patients (safe ratios maintained). Time to learn, make mistakes safely. Preceptor: 'We'll build your skills gradually, no rush.'",
                2: "Shadow preceptor, taking 2-3 patients supervised. Time for thorough assessments, learning documentation system. Lunch breaks protected (other nurse covers). Questions welcomed, not punished.",
                3: "Building competence: Taking 4 patients with preceptor nearby. Complex case, you notice patient deteriorating. Call preceptor, she validates concern, escalates appropriately. Good catch, patient to ICU, lives. You're LEARNING, not just surviving.",
                4: "Participate in unit governance meeting. Nurses identify problem: med room layout inefficient. Committee formed, nurses redesign it. You help shape your environment - this is AGENCY.",
                5: "Challenging case but adequate support. Physician asks YOUR input: 'What do you think clinically?' Your assessment valued, incorporated into care plan. Professional respect, not just task completion.",
                6: "NO CHOICE POINT because metabolic systems don't force harmful dilemmas. Adequate staffing means no impossible situations. Values-aligned: encouraged to escalate concerns, maintain standards. Moral satisfaction building.",
                7: "Developing confidence: Full patient load now (5 patients), handling complex cases. Preceptor available but you're increasingly independent. Sense of mastery, competence. Identity: 'I'm becoming a good nurse.'",
                8: "Continuing growth: FHRI 82-88. No breakdown because system supports you. Challenge with manageable stress = eustress, builds capacity. PFC strengthening through challenge-mastery cycles.",
                9: "Starting to precept newer nurses (you, 9 months in, helping others). Paying forward the support you received. Meaningful work, moral satisfaction. Relationships thriving - energy for life outside work.",
                10: "Participating in policy decisions: Unit evaluating new equipment, your input sought. Autonomy respected, professional judgment valued. This is what nursing should be.",
                11: "Health improving: Regular sleep (7-8 hrs), exercise routine maintained, relationships deepening. Work challenging but sustainable. Body and mind thriving.",
                12: "YEAR END: Both orchids and dandelions thriving (FHRI 85-92). Sensitivity = asset in metabolic system (orchids' empathy valued, dandelions' steadiness utilized). GrimAge stable or slightly improved (meaningful work = longevity). Planning to stay years. System quality > phenotype."
            },
            warehouse_extractive: {
                1: "Gamification begins: Badge scan shows 'You're #847 in productivity!' Top 10% get recognition, bottom 10% get 'coached.' Immediate ranking against everyone. Target: 300 items/hour (one every 12 seconds).",
                3: "Can't hit rate without cutting safety: Coworker at 340 items/hour, you watch her - no knee bending, awkward reaches. Choice: Hit rate (hurt body) or miss rate (get fired).",
                6: "FORCED CHOICE: Algorithm assigns picks requiring ladder. Ladder broken. Report it (miss rate, get coached) or use broken ladder (risk injury, hit rate). Both options harmful - extractive signature.",
                8: "ORCHID: Back spasms, can't get out of bed. Body broke before mind. Exit protective. DANDELION: Chronic pain normalized ('everyone hurts'), continuing work. Lumbar disc damage building silently.",
                12: "ORCHID: Exited month 3-4, moderate RSI, recoverable. DANDELION: Still working, FHRI 58, but herniated disc developing, carpal tunnel syndrome building, +1.4 years GrimAge. Sudden injury or breakdown coming at months 18-24."
            },
            warehouse_metabolic: {
                1: "Worker-owned cooperative: 'We decide pace collectively.' Current rate: 180 items/hour (sustainable, evidence-based). Profit-sharing: everyone benefits from efficiency. No ranking.",
                6: "Equipment broken: Work stops until fixed. Safety prioritized over productivity. No forced dilemmas. Workers control pace, adequate breaks, ergonomic design.",
                12: "Both phenotypes thriving: FHRI 85+. Sustainable pace maintained, bodies healthy, engaged work. Hidden damage: NONE. Same work, different institutional design, opposite outcomes."
            }
        };
        
        let comparisonState = {
            month: 0, // Changed from week to month
            isRunning: false,
            intervalId: null,
            choicePointShown: false,
            speed: 3000, // milliseconds per month (default 3 seconds)
            autoPauseOnCritical: true,
            scenarioA: {
                sensitivity: null,
                stress: null,
                environment: null,
                biobond: 50,
                data: { lgc: [0.4], cpfc: [0.85], mfp: [0], fhri: [78], grimAge: [0], cvRisk: [0] },
                events: [],
                choiceMade: null
            },
            scenarioB: {
                sensitivity: null,
                stress: null,
                environment: null,
                biobond: 50,
                data: { lgc: [0.4], cpfc: [0.85], mfp: [0], fhri: [78], grimAge: [0], cvRisk: [0] },
                events: [],
                choiceMade: null
            }
        };
        
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            window.scrollTo(0, 0);
            
            const sectionHeading = document.querySelector(`#${sectionId} h2`);
            if (sectionHeading) {
                announce(`Navigated to ${sectionHeading.textContent}`);
            }
        }
        
        function setBiobond(scenario, value) {
            document.getElementById(`comp-biobond-${scenario}`).value = value;
            document.getElementById(`comp-biobond-display-${scenario}`).textContent = value + '%';
            announce(`Set ${scenario === 'a' ? 'Scenario A' : 'Scenario B'} BioBond to ${value} percent`);
        }
        
        function updateSpeed() {
            const speedValue = parseInt(document.getElementById('speed-control').value);
            comparisonState.speed = speedValue * 1000; // Convert to milliseconds
            document.getElementById('speed-display').textContent = `${speedValue} second${speedValue > 1 ? 's' : ''} per month`;
            
            // If simulation is running, restart with new speed
            if (comparisonState.isRunning) {
                clearInterval(comparisonState.intervalId);
                startInterval();
            }
            
            announce(`Speed set to ${speedValue} seconds per month`);
        }
        
        function stepForward() {
            // If already at month 12, don't advance
            if (comparisonState.month >= 12) {
                announce('Simulation complete at month 12');
                return;
            }
            
            // Pause if running
            if (comparisonState.isRunning) {
                pauseComparison();
            }
            
            // Check for choice point at month 6
            if (comparisonState.month === 5 && !comparisonState.choicePointShown) {
                if (comparisonState.scenarioA.environment === 'extractive' || comparisonState.scenarioB.environment === 'extractive') {
                    showChoicePoint();
                    return;
                }
            }
            
            // Advance one month
            advanceComparisonMonth();
            
            // Check if complete
            if (comparisonState.month >= 12) {
                showComparisonSummary();
            }
        }
        
        function runComparison() {
            const sensA = document.getElementById('comp-sens-a').value;
            const stressA = document.getElementById('comp-stress-a').value;
            const envA = document.getElementById('comp-env-a').value;
            const sensB = document.getElementById('comp-sens-b').value;
            const stressB = document.getElementById('comp-stress-b').value;
            const envB = document.getElementById('comp-env-b').value;
            
            if (!sensA || !stressA || !envA) {
                alert('Please configure all options for Scenario A');
                return;
            }
            if (!sensB || !stressB || !envB) {
                alert('Please configure all options for Scenario B');
                return;
            }
            
            comparisonState.month = 0; // Changed from week
            comparisonState.choicePointShown = false;
            comparisonState.scenarioA = {
                sensitivity: sensA,
                stress: stressA,
                environment: envA,
                biobond: parseInt(document.getElementById('comp-biobond-a').value),
                data: { lgc: [calculateInitialLGC(sensA)], cpfc: [0.85], mfp: [0], fhri: [78], grimAge: [0], cvRisk: [0] },
                events: [{month: 0, type: 'milestone', text: 'Simulation begins - Month 0 baseline'}], // Changed week to month
                choiceMade: null
            };
            comparisonState.scenarioB = {
                sensitivity: sensB,
                stress: stressB,
                environment: envB,
                biobond: parseInt(document.getElementById('comp-biobond-b').value),
                data: { lgc: [calculateInitialLGC(sensB)], cpfc: [0.85], mfp: [0], fhri: [78], grimAge: [0], cvRisk: [0] },
                events: [{month: 0, type: 'milestone', text: 'Simulation begins - Month 0 baseline'}], // Changed week to month
                choiceMade: null
            };
            
            showSection('comparison-results');
            
            document.getElementById('comp-description-a').textContent = 
                `${capitalize(sensA)}-${capitalize(stressA)} in ${capitalize(envA)} (${comparisonState.scenarioA.biobond}% BioBond)`;
            document.getElementById('comp-description-b').textContent = 
                `${capitalize(sensB)}-${capitalize(stressB)} in ${capitalize(envB)} (${comparisonState.scenarioB.biobond}% BioBond)`;
            
            updateComparisonDisplay();
            
            announce('Comparison initialized. 12-month timeline matches real-world data. Press play to start.');
        }
        
        function calculateInitialLGC(sensitivity) {
            const baseLGC = {
                'orchid': 0.45,
                'tulip': 0.40,
                'dandelion': 0.35
            };
            return baseLGC[sensitivity];
        }
        
        function capitalize(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }
        
        function toggleComparisonPlay() {
            if (comparisonState.isRunning) {
                pauseComparison();
            } else {
                playComparison();
            }
        }
        
        function playComparison() {
            comparisonState.isRunning = true;
            document.getElementById('comp-play-button').textContent = '‚è∏Ô∏è';
            document.getElementById('comp-play-button').classList.add('playing');
            document.getElementById('comp-play-button').setAttribute('aria-label', 'Pause comparison simulation');
            announce('Comparison simulation playing');
            
            startInterval();
        }
        
        function startInterval() {
            comparisonState.intervalId = setInterval(() => {
                // Check for choice point at month 6 in extractive environments
                if (comparisonState.month === 5 && !comparisonState.choicePointShown) {
                    if (comparisonState.scenarioA.environment === 'extractive' || comparisonState.scenarioB.environment === 'extractive') {
                        pauseComparison();
                        showChoicePoint();
                        return;
                    }
                }
                
                advanceComparisonMonth();
                
                // Auto-pause on critical events if enabled
                if (comparisonState.autoPauseOnCritical) {
                    const lastEventA = comparisonState.scenarioA.events[comparisonState.scenarioA.events.length - 1];
                    const lastEventB = comparisonState.scenarioB.events[comparisonState.scenarioB.events.length - 1];
                    
                    if ((lastEventA && lastEventA.type === 'critical' && lastEventA.month === comparisonState.month) ||
                        (lastEventB && lastEventB.type === 'critical' && lastEventB.month === comparisonState.month)) {
                        pauseComparison();
                        announce(`Paused at month ${comparisonState.month} - critical event occurred. Press play to continue or use Next Month button.`);
                        return;
                    }
                }
                
                if (comparisonState.month >= 12) {
                    pauseComparison();
                    showComparisonSummary();
                }
            }, comparisonState.speed); // Use variable speed
        }
        
        function pauseComparison() {
            comparisonState.isRunning = false;
            document.getElementById('comp-play-button').textContent = '‚ñ∂Ô∏è';
            document.getElementById('comp-play-button').classList.remove('playing');
            document.getElementById('comp-play-button').setAttribute('aria-label', 'Play comparison simulation');
            clearInterval(comparisonState.intervalId);
            announce('Comparison simulation paused');
        }
        
        function showChoicePoint() {
            comparisonState.choicePointShown = true;
            document.getElementById('choice-modal').style.display = 'flex';
            announce('Month 6 choice point reached. Institution forcing a decision. This matches when many workers face critical dilemmas.');
        }
        
        function makeChoice(choice) {
            document.getElementById('choice-modal').style.display = 'none';
            
            // Apply choice consequences to both scenarios if in extractive
            if (comparisonState.scenarioA.environment === 'extractive') {
                comparisonState.scenarioA.choiceMade = choice;
                if (choice === 'comply') {
                    // Lower immediate stress, higher moral debt
                    comparisonState.scenarioA.data.lgc[comparisonState.month] -= 0.1;
                    comparisonState.scenarioA.data.mfp[comparisonState.month] += 0.2;
                    comparisonState.scenarioA.events.push({month: comparisonState.month, type: 'warning', text: 'Complied with unsafe demand. Moral debt increased.'});
                } else {
                    // Higher stress, maintained integrity
                    comparisonState.scenarioA.data.lgc[comparisonState.month] += 0.15;
                    comparisonState.scenarioA.events.push({month: comparisonState.month, type: 'warning', text: 'Resisted demand. Facing retaliation, but values intact.'});
                }
            }
            
            if (comparisonState.scenarioB.environment === 'extractive') {
                comparisonState.scenarioB.choiceMade = choice;
                if (choice === 'comply') {
                    comparisonState.scenarioB.data.lgc[comparisonState.month] -= 0.1;
                    comparisonState.scenarioB.data.mfp[comparisonState.month] += 0.2;
                    comparisonState.scenarioB.events.push({month: comparisonState.month, type: 'warning', text: 'Complied with unsafe demand. Moral debt increased.'});
                } else {
                    comparisonState.scenarioB.data.lgc[comparisonState.month] += 0.15;
                    comparisonState.scenarioB.events.push({month: comparisonState.month, type: 'warning', text: 'Resisted demand. Facing retaliation, but values intact.'});
                }
            }
            
            updateComparisonDisplay();
            announce(`Choice made: ${choice}. Continuing simulation.`);
            playComparison();
        }
        
        function advanceComparisonMonth() {
            comparisonState.month++;
            document.getElementById('comp-week-display').textContent = comparisonState.month;
            
            calculateScenarioMonth(comparisonState.scenarioA, comparisonState.month);
            calculateScenarioMonth(comparisonState.scenarioB, comparisonState.month);
            
            updateComparisonDisplay();
            
            // Announce progress every 2 months or on critical events
            if (comparisonState.month % 2 === 0) {
                announce(`Month ${comparisonState.month} of 12`);
            }
            
            // Scroll to latest events in timelines
            const timelineA = document.getElementById('comp-timeline-a');
            const timelineB = document.getElementById('comp-timeline-b');
            if (timelineA) timelineA.scrollTop = timelineA.scrollHeight;
            if (timelineB) timelineB.scrollTop = timelineB.scrollHeight;
        }
        
        function calculateScenarioMonth(scenario, month) {
            const prevLGC = scenario.data.lgc[month - 1];
            const prevCPFC = scenario.data.cpfc[month - 1];
            const prevMFP = scenario.data.mfp[month - 1];
            const prevGrimAge = scenario.data.grimAge[month - 1];
            const prevCVRisk = scenario.data.cvRisk[month - 1];
            
            // CRITICAL FIX: Metabolic vs Extractive have fundamentally different dynamics
            const isMetabolic = scenario.environment === 'metabolic';
            const stressInput = isMetabolic ? 0.03 : 0.15; // Metabolic: eustress only
            
            const sensModifier = {
                'orchid': 1.5,
                'tulip': 1.0,
                'dandelion': 0.7
            }[scenario.sensitivity];
            
            const biobondEffect = scenario.biobond / 100;
            
            // Calculate new L_GC
            let newLGC;
            if (isMetabolic) {
                // METABOLIC: Eustress with strong recovery - net downward trajectory
                const eustress = stressInput * sensModifier * (1 - biobondEffect * 0.8);
                const recovery = 0.04 * biobondEffect + 0.02; // Stronger base recovery
                newLGC = prevLGC + eustress - recovery;
                
                // In metabolic, L_GC should trend toward healthy baseline (0.30-0.35)
                if (newLGC < 0.30) newLGC = 0.30; // Floor at healthy stress
            } else {
                // EXTRACTIVE: Distress accumulates, recovery insufficient
                const distress = stressInput * sensModifier * (1 - biobondEffect * 0.6);
                const recovery = 0.02 * biobondEffect;
                newLGC = prevLGC + distress - recovery;
            }
            newLGC = Math.max(0.1, Math.min(1.0, newLGC));
            
            // Calculate new C_PFC
            let newCPFC;
            if (isMetabolic) {
                // METABOLIC: Challenge-mastery cycles STRENGTHEN PFC over time
                const challenge = newLGC * 0.3; // Manageable challenge
                const mastery = 0.02 * biobondEffect + 0.01; // Capacity building
                newCPFC = prevCPFC - challenge + mastery;
                
                // PFC should trend upward in metabolic (learning, growth)
                if (newCPFC > 0.95) newCPFC = 0.95; // Ceiling at peak capacity
                
                // Stress style modifiers (smaller in metabolic)
                if (scenario.stress === 'warrior') {
                    newCPFC += 0.02; // Warriors thrive in structured challenge
                } else if (scenario.stress === 'worrier') {
                    newCPFC -= 0.01; // Worriers slightly more cautious
                }
            } else {
                // EXTRACTIVE: Chronic stress DEPLETES PFC
                newCPFC = 0.95 - (newLGC * 0.8);
                if (scenario.stress === 'warrior') {
                    newCPFC += 0.05;
                } else if (scenario.stress === 'worrier') {
                    newCPFC -= 0.08;
                }
            }
            newCPFC = Math.max(0.1, Math.min(0.95, newCPFC));
            
            // Calculate Moral Debt
            let newMFP = prevMFP;
            if (scenario.environment === 'extractive') {
                const moralDebtAccrual = 0.04 * (1 - biobondEffect * 0.5);
                newMFP += moralDebtAccrual;
            } else {
                // METABOLIC: Moral satisfaction - values aligned work
                newMFP = Math.max(0, newMFP - 0.03); // Active reduction
            }
            newMFP = Math.max(0, Math.min(1.0, newMFP));
            
            // Calculate Hidden Damage (dandelions in extractive only)
            let newGrimAge = prevGrimAge;
            let newCVRisk = prevCVRisk;
            
            if (scenario.sensitivity === 'dandelion' && scenario.environment === 'extractive') {
                // Dandelions accumulate silent damage in extractive
                const grimAgeRate = 0.15 * (1 - biobondEffect * 0.4);
                newGrimAge += grimAgeRate;
                
                const cvRiskRate = 3 * (1 - biobondEffect * 0.3);
                newCVRisk += cvRiskRate;
            } else if (isMetabolic && month >= 6) {
                // METABOLIC: Meaningful work IMPROVES biological age slightly
                newGrimAge = Math.max(0, newGrimAge - 0.02);
                newCVRisk = Math.max(0, newCVRisk - 0.5);
            }
            
            // Calculate FHRI
            let newFHRI;
            if (isMetabolic) {
                // METABOLIC: Components weighted toward thriving
                const fhriBase = 100 * (
                    0.4 * newCPFC +           // Cognitive capacity
                    0.3 * (1 - newLGC) +      // Stress management
                    0.3 * (1 - newMFP)        // Value alignment
                );
                newFHRI = fhriBase + 15; // Metabolic bonus: meaningful work, autonomy
            } else {
                // EXTRACTIVE: Components weighted toward crisis
                const fhriBase = 100 * (
                    0.4 * newCPFC + 
                    0.3 * (1 - newLGC) + 
                    0.3 * (1 - newMFP)
                );
                newFHRI = fhriBase - 5; // Extractive penalty
            }
            newFHRI = Math.max(10, Math.min(100, newFHRI));
            
            // Store values
            scenario.data.lgc.push(newLGC);
            scenario.data.cpfc.push(newCPFC);
            scenario.data.mfp.push(newMFP);
            scenario.data.fhri.push(newFHRI);
            scenario.data.grimAge.push(newGrimAge);
            scenario.data.cvRisk.push(newCVRisk);
            
            checkScenarioThresholds(scenario, month, newLGC, newCPFC, newMFP, newFHRI, newGrimAge, newCVRisk);
        }
        
        function checkScenarioThresholds(scenario, month, lgc, cpfc, mfp, fhri, grimAge, cvRisk) {
            const isMetabolic = scenario.environment === 'metabolic';
            
            // In metabolic environments, moderate metrics are healthy challenge, not crisis
            if (!isMetabolic) {
                // EXTRACTIVE: These are real warnings
                if (cpfc < 0.6 && scenario.data.cpfc[month - 1] >= 0.6) {
                    scenario.events.push({month, type: 'warning', text: 'PFC capacity below 60% - ethical reasoning compromised'});
                }
                if (cpfc < 0.4 && scenario.data.cpfc[month - 1] >= 0.4) {
                    scenario.events.push({month, type: 'critical', text: 'PFC critically depleted - automatic mode only'});
                }
                if (lgc > 0.7 && scenario.data.lgc[month - 1] <= 0.7) {
                    scenario.events.push({month, type: 'warning', text: 'Chronic stress - hippocampal atrophy beginning'});
                }
                if (mfp > 0.5 && scenario.data.mfp[month - 1] <= 0.5) {
                    scenario.events.push({month, type: 'warning', text: 'Significant moral debt - identity fragmentation'});
                }
                if (fhri < 50 && scenario.data.fhri[month - 1] >= 50) {
                    scenario.events.push({month, type: 'critical', text: 'FHRI below 50 - burnout zone, exit recommended'});
                }
                
                // Hidden damage warnings for dandelions in extractive
                if (scenario.sensitivity === 'dandelion') {
                    if (grimAge > 1.0 && scenario.data.grimAge[month - 1] <= 1.0) {
                        scenario.events.push({month, type: 'warning', text: 'GrimAge +1 year - epigenetic aging accelerating'});
                    }
                    if (cvRisk > 30 && scenario.data.cvRisk[month - 1] <= 30) {
                        scenario.events.push({month, type: 'critical', text: 'Cardiovascular risk elevated 30% - silent arterial damage'});
                    }
                }
            } else {
                // METABOLIC: Only trigger on actual problems (which should be rare)
                if (fhri < 70 && scenario.data.fhri[month - 1] >= 70 && month > 6) {
                    scenario.events.push({month, type: 'milestone', text: 'FHRI dipped below 70 - check if additional support needed'});
                }
                
                // Positive milestones in metabolic
                if (month === 3 && fhri >= 80) {
                    scenario.events.push({month, type: 'milestone', text: 'Competence building - thriving in supportive environment'});
                }
                if (month === 6 && fhri >= 85) {
                    scenario.events.push({month, type: 'milestone', text: 'Fully integrated - contributing meaningfully, values aligned'});
                }
                if (month === 12 && fhri >= 85) {
                    scenario.events.push({month, type: 'milestone', text: 'Year complete - sustained thriving, planning to stay long-term'});
                }
            }
        }
        
        function updateComparisonDisplay() {
            const month = comparisonState.month;
            
            updateScenarioDisplay('a', comparisonState.scenarioA, month);
            updateScenarioDisplay('b', comparisonState.scenarioB, month);
        }
        
        function updateScenarioDisplay(id, scenario, month) {
            const fhri = scenario.data.fhri[month];
            const cpfc = scenario.data.cpfc[month];
            const lgc = scenario.data.lgc[month];
            const mfp = scenario.data.mfp[month];
            const grimAge = scenario.data.grimAge[month];
            const cvRisk = scenario.data.cvRisk[month];
            
            // Update metric displays
            const fhriEl = document.getElementById(`comp-fhri-${id}`);
            fhriEl.textContent = Math.round(fhri);
            fhriEl.className = 'metric-value ' + (fhri >= 70 ? 'good' : fhri >= 50 ? 'warning' : 'critical');
            
            const cpfcEl = document.getElementById(`comp-cpfc-${id}`);
            cpfcEl.textContent = Math.round(cpfc * 100) + '%';
            cpfcEl.className = 'metric-value ' + (cpfc >= 0.6 ? 'good' : cpfc >= 0.4 ? 'warning' : 'critical');
            
            const lgcEl = document.getElementById(`comp-lgc-${id}`);
            lgcEl.textContent = Math.round(lgc * 100) + '%';
            lgcEl.className = 'metric-value ' + (lgc <= 0.6 ? 'good' : lgc <= 0.8 ? 'warning' : 'critical');
            
            const mfpEl = document.getElementById(`comp-mfp-${id}`);
            mfpEl.textContent = Math.round(mfp * 100) + '%';
            mfpEl.className = 'metric-value ' + (mfp <= 0.4 ? 'good' : mfp <= 0.7 ? 'warning' : 'critical');
            
            // NEW: Update visual chart
            updateVisualChart(id, scenario, month);
            
            // NEW: Update symptom log
            updateSymptomLog(id, scenario, month);
            
            // NEW: Update monthly narrative
            updateMonthlyNarrative(id, scenario, month);
            
            // NEW: Update Sapolsky multi-level chart
            updateSapolskyChart(id, scenario, month);
            
            // NEW: Update hidden damage display for dandelions
            if (scenario.sensitivity === 'dandelion' && scenario.environment === 'extractive') {
                updateHiddenDamage(id, grimAge, cvRisk, fhri);
            } else {
                document.getElementById(`hidden-damage-${id}`).style.display = 'none';
            }
            
            // Update timeline
            const timelineEl = document.getElementById(`comp-timeline-${id}`);
            const eventsHtml = scenario.events.map(event => `
                <div class="timeline-event ${event.type}">
                    <span class="event-week">Month ${event.month}:</span> ${event.text}
                </div>
            `).join('');
            timelineEl.innerHTML = '<p style="font-weight: 600; margin-bottom: 10px;">Timeline:</p>' + eventsHtml;
            timelineEl.scrollTop = timelineEl.scrollHeight;
        }
        
        // NEW: Visual chart update function
        function updateVisualChart(id, scenario, month) {
            const chartContainer = document.getElementById(`chart-${id}`);
            
            if (month === 0) chartContainer.innerHTML = '';
            
            const fhri = scenario.data.fhri[month];
            const bar = document.createElement('div');
            bar.className = 'chart-bar';
            
            bar.style.height = `${Math.max(5, fhri)}%`;
            
            if (fhri >= 70) bar.classList.add('healthy');
            else if (fhri >= 50) bar.classList.add('warning');
            else bar.classList.add('critical');
            
            bar.setAttribute('data-value', `M${month}: ${Math.round(fhri)}`);
            bar.setAttribute('aria-label', `Month ${month}: FHRI ${Math.round(fhri)}`);
            
            chartContainer.appendChild(bar);
        }
        
        // NEW: Symptom log function
        function updateSymptomLog(id, scenario, month) {
            const logEl = document.getElementById(`symptom-log-${id}`);
            const cpfc = scenario.data.cpfc[month];
            const lgc = scenario.data.lgc[month];
            const mfp = scenario.data.mfp[month];
            const isMetabolic = scenario.environment === 'metabolic';
            
            const symptoms = [];
            
            // In metabolic environments, use stricter thresholds (only show if truly struggling)
            // In extractive environments, show symptoms at normal thresholds
            const cpfcCritical = isMetabolic ? 0.3 : 0.4;
            const cpfcWarning = isMetabolic ? 0.5 : 0.6;
            const lgcCritical = isMetabolic ? 0.85 : 0.8;
            const lgcWarning = isMetabolic ? 0.75 : 0.7;
            const mfpCritical = isMetabolic ? 0.8 : 0.7;
            const mfpWarning = isMetabolic ? 0.6 : 0.5;
            
            if (cpfc < cpfcCritical) {
                symptoms.push("You snap at colleagues over minor issues");
                symptoms.push("Cannot focus on complex tasks");
                symptoms.push("Ethical reasoning feels impossible");
            } else if (cpfc < cpfcWarning) {
                symptoms.push("Difficulty thinking through decisions");
                symptoms.push("Procrastinating on important work");
            }
            
            if (lgc > lgcCritical) {
                symptoms.push("Can't remember what you read");
                symptoms.push("Physical tension (jaw clenched, shoulders tight)");
            } else if (lgc > lgcWarning) {
                symptoms.push("Sleep disrupted despite exhaustion");
                symptoms.push("Minor stressors feel overwhelming");
            }
            
            if (mfp > mfpCritical) {
                symptoms.push("Feel like a fraud or hypocrite");
                symptoms.push("Cynicism about values you once held");
            } else if (mfp > mfpWarning) {
                symptoms.push("Guilt about cutting corners");
                symptoms.push("Avoiding thinking about work values");
            }
            
            if (symptoms.length > 0) {
                const isCritical = cpfc < cpfcCritical || lgc > lgcCritical || mfp > mfpCritical;
                logEl.className = isCritical ? 'symptom-log critical' : 'symptom-log';
                logEl.style.display = 'block';
                logEl.innerHTML = `
                    <h4>${isCritical ? 'üö®' : '‚ö†Ô∏è'} This Month's Symptoms:</h4>
                    <ul>${symptoms.map(s => `<li>${s}</li>`).join('')}</ul>
                `;
            } else {
                logEl.style.display = 'none';
            }
        }
        
        // NEW: Hidden damage display for dandelions
        function updateHiddenDamage(id, grimAge, cvRisk, fhri) {
            const damageEl = document.getElementById(`hidden-damage-${id}`);
            
            if (grimAge > 0.5 || cvRisk > 15) {
                damageEl.style.display = 'block';
                damageEl.className = 'hidden-damage-alert';
                damageEl.innerHTML = `
                    <h3>‚ö†Ô∏è Silent Damage Accumulating</h3>
                    <p style="margin-bottom: 15px;"><strong>You appear "functional" (FHRI ${Math.round(fhri)}), but hidden costs are mounting:</strong></p>
                    <div class="damage-metric">
                        <span class="damage-metric-label">GrimAge Biological Aging:</span>
                        <span class="damage-metric-value">+${grimAge.toFixed(1)} years</span>
                    </div>
                    <div class="damage-metric">
                        <span class="damage-metric-label">Cardiovascular Risk Increase:</span>
                        <span class="damage-metric-value">+${Math.round(cvRisk)}%</span>
                    </div>
                    <p style="margin-top: 15px; font-size: 0.9em;"><strong>The Dandelion Trap:</strong> Feeling fine ‚â† Being fine. Your resilience enables exploitation. This silent damage is WORSE than orchid's visible collapse because you stay exposed longer.</p>
                `;
            } else {
                damageEl.style.display = 'none';
            }
        }
        
        // NEW: Monthly narrative display - shows what's actually happening
        function updateMonthlyNarrative(id, scenario, month) {
            const narrativeEl = document.getElementById(`narrative-${id}`);
            const narrativeContent = document.getElementById(`narrative-content-${id}`);
            
            // Determine which narrative set to use
            let narrativeKey = '';
            
            // Primary narratives: nursing (most developed)
            if (scenario.environment === 'extractive') {
                narrativeKey = 'nursing_extractive';
            } else {
                narrativeKey = 'nursing_metabolic';
            }
            
            // Get narrative for this month
            const narrative = monthlyNarratives[narrativeKey]?.[month];
            
            if (narrative && month > 0) {
                narrativeEl.style.display = 'block';
                narrativeContent.innerHTML = `<p style="margin: 0;">${narrative}</p>`;
            } else {
                narrativeEl.style.display = 'none';
            }
        }
        
        // NEW: Sapolsky Multi-Level Timescale Chart Functions
        function toggleSapolsky(id) {
            const content = document.getElementById(`sapolsky-content-${id}`);
            const toggle = document.getElementById(`sapolsky-toggle-${id}`);
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                toggle.textContent = '‚ñ≤';
                announce('Biological changes detail expanded');
            } else {
                content.style.display = 'none';
                toggle.textContent = '‚ñº';
                announce('Biological changes detail collapsed');
            }
        }
        
        function updateSapolskyChart(id, scenario, month) {
            // Don't show at month 0
            if (month === 0) return;
            
            const contentEl = document.getElementById(`sapolsky-content-${id}`);
            const lgc = scenario.data.lgc[month];
            const cpfc = scenario.data.cpfc[month];
            const mfp = scenario.data.mfp[month];
            const fhri = scenario.data.fhri[month];
            const grimAge = scenario.data.grimAge[month];
            const cvRisk = scenario.data.cvRisk[month];
            const isMetabolic = scenario.environment === 'metabolic';
            
            let html = `
                <p style="font-size: 0.85em; color: #713f12; margin-bottom: 15px; font-style: italic;">
                    From Robert Sapolsky's "Why Zebras Don't Get Ulcers": Stress operates on multiple biological timescales simultaneously. 
                    Institutional design cascades through all levels - from neurotransmitters (seconds) to disease (years).
                </p>
            `;
            
            // LEVEL 1: NEURAL (Seconds-Minutes)
            html += `
                <div style="margin-bottom: 15px; padding: 12px; background: white; border-left: 4px solid #6b7280; border-radius: 4px;">
                    <h5 style="margin: 0 0 8px 0; color: #374151; font-size: 0.95em;">‚ö° NEURAL (Seconds-Minutes)</h5>
                    <p style="margin: 0 0 5px 0; font-size: 0.85em; color: #4b5563;"><strong>Mechanism:</strong> Neurotransmitter release (adrenaline, glutamate, GABA)</p>
                    <p style="margin: 0; font-size: 0.85em; color: #6b7280;">
                        ${isMetabolic 
                            ? 'üü¢ Healthy arousal during challenges, normal recovery between tasks' 
                            : 'üî¥ Continuous hyperarousal, adrenaline surges during each shift, no recovery periods'}
                    </p>
                    <p style="margin: 5px 0 0 0; font-size: 0.8em; color: #9ca3af;"><em>Too rapid for tracking - happens constantly</em></p>
                </div>
            `;
            
            // LEVEL 2: HORMONAL (Minutes-Hours, Pattern Over Months)
            const lgcStatus = lgc <= 0.35 ? 'good' : lgc <= 0.6 ? 'warning' : 'critical';
            const lgcColor = lgcStatus === 'good' ? '#10b981' : lgcStatus === 'warning' ? '#f59e0b' : '#ef4444';
            const lgcBar = `<div style="width: ${Math.round(lgc * 100)}%; height: 20px; background: ${lgcColor}; border-radius: 4px; transition: all 0.3s;"></div>`;
            
            html += `
                <div style="margin-bottom: 15px; padding: 12px; background: white; border-left: 4px solid ${lgcColor}; border-radius: 4px;">
                    <h5 style="margin: 0 0 8px 0; color: #374151; font-size: 0.95em;">ü©∏ HORMONAL (Minutes-Hours, Pattern Over Months)</h5>
                    <p style="margin: 0 0 5px 0; font-size: 0.85em; color: #4b5563;"><strong>Mechanism:</strong> HPA axis activation, cortisol release</p>
                    <div style="margin: 8px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                            <span style="font-size: 0.85em; color: #374151; font-weight: 600;">L_GC (Glucocorticoid Load):</span>
                            <span style="font-size: 0.85em; color: ${lgcColor}; font-weight: 600;">${Math.round(lgc * 100)}%</span>
                        </div>
                        <div style="width: 100%; background: #e5e7eb; border-radius: 4px; overflow: hidden;">
                            ${lgcBar}
                        </div>
                    </div>
                    <p style="margin: 8px 0 0 0; font-size: 0.85em; color: #6b7280;">
                        ${isMetabolic 
                            ? `üü¢ ${lgc <= 0.35 ? 'Healthy baseline - cortisol patterns normal, eustress only' : 'Slightly elevated but recovers - manageable challenge'}` 
                            : `üî¥ ${month} months of chronic elevation - flattened circadian rhythm, sustained high cortisol`}
                    </p>
                    <p style="margin: 5px 0 0 0; font-size: 0.8em; color: #9ca3af;"><em>Sapolsky Ch. 2: HPA axis dysregulation develops over weeks-months</em></p>
                </div>
            `;
            
            // LEVEL 3: GENE EXPRESSION (Hours-Days)
            html += `
                <div style="margin-bottom: 15px; padding: 12px; background: white; border-left: 4px solid #8b5cf6; border-radius: 4px;">
                    <h5 style="margin: 0 0 8px 0; color: #374151; font-size: 0.95em;">üß¨ GENE EXPRESSION (Hours-Days)</h5>
                    <p style="margin: 0 0 5px 0; font-size: 0.85em; color: #4b5563;"><strong>Mechanism:</strong> Transcription factors (c-Fos, CREB), inflammatory gene activation</p>
                    <p style="margin: 0; font-size: 0.85em; color: #6b7280;">
                        ${isMetabolic 
                            ? 'üü¢ Healthy gene expression patterns - growth factors, neuroplasticity genes' 
                            : 'üî¥ Inflammatory genes activated, stress response genes dysregulated, changes accumulating over ' + month + ' months'}
                    </p>
                    <p style="margin: 5px 0 0 0; font-size: 0.8em; color: #9ca3af;"><em>Contributes to cellular-level changes visible in weeks</em></p>
                </div>
            `;
            
            // LEVEL 4: CELLULAR (Days-Weeks)
            const cpfcStatus = cpfc >= 0.7 ? 'good' : cpfc >= 0.5 ? 'warning' : 'critical';
            const cpfcColor = cpfcStatus === 'good' ? '#10b981' : cpfcStatus === 'warning' ? '#f59e0b' : '#ef4444';
            const cpfcBar = `<div style="width: ${Math.round(cpfc * 100)}%; height: 20px; background: ${cpfcColor}; border-radius: 4px; transition: all 0.3s;"></div>`;
            
            html += `
                <div style="margin-bottom: 15px; padding: 12px; background: white; border-left: 4px solid ${cpfcColor}; border-radius: 4px;">
                    <h5 style="margin: 0 0 8px 0; color: #374151; font-size: 0.95em;">üî¨ CELLULAR (Days-Weeks)</h5>
                    <p style="margin: 0 0 5px 0; font-size: 0.85em; color: #4b5563;"><strong>Mechanism:</strong> Dendritic remodeling, synaptic pruning, neuronal structure changes</p>
                    <div style="margin: 8px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                            <span style="font-size: 0.85em; color: #374151; font-weight: 600;">C_PFC (Prefrontal Capacity):</span>
                            <span style="font-size: 0.85em; color: ${cpfcColor}; font-weight: 600;">${Math.round(cpfc * 100)}%</span>
                        </div>
                        <div style="width: 100%; background: #e5e7eb; border-radius: 4px; overflow: hidden;">
                            ${cpfcBar}
                        </div>
                    </div>
                    <p style="margin: 8px 0 0 0; font-size: 0.85em; color: #6b7280;">
                        ${isMetabolic 
                            ? `üü¢ PFC dendrites ${cpfc > 0.85 ? 'expanding through challenge-mastery cycles, complexity increasing' : 'maintaining healthy structure, supporting ethical reasoning'}` 
                            : `üî¥ PFC dendrites ${cpfc < 0.5 ? 'severely retracted and simplified over ' + month + ' months, hippocampal atrophy beginning' : 'retracting under chronic stress, complexity declining'}`}
                    </p>
                    <p style="margin: 5px 0 0 0; font-size: 0.8em; color: #9ca3af;"><em>Sapolsky Ch. 10: Dendritic changes visible after 2-3 weeks of chronic stress</em></p>
                </div>
            `;
            
            // LEVEL 5: TISSUE/ORGAN (Weeks-Months)
            const tissueStatus = (grimAge > 1.0 || cvRisk > 25) ? 'critical' : (grimAge > 0.5 || cvRisk > 15) ? 'warning' : 'good';
            const tissueColor = tissueStatus === 'good' ? '#10b981' : tissueStatus === 'warning' ? '#f59e0b' : '#ef4444';
            
            html += `
                <div style="margin-bottom: 15px; padding: 12px; background: white; border-left: 4px solid ${tissueColor}; border-radius: 4px;">
                    <h5 style="margin: 0 0 8px 0; color: #374151; font-size: 0.95em;">ü´Ä TISSUE/ORGAN (Weeks-Months)</h5>
                    <p style="margin: 0 0 5px 0; font-size: 0.85em; color: #4b5563;"><strong>Mechanism:</strong> Structural remodeling - hippocampal volume, cardiovascular changes</p>
                    <div style="margin: 8px 0;">
                        ${scenario.sensitivity === 'dandelion' && grimAge > 0.1 ? `
                            <div style="margin-bottom: 8px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                    <span style="font-size: 0.85em; color: #374151; font-weight: 600;">GrimAge (Biological Aging):</span>
                                    <span style="font-size: 0.85em; color: ${tissueColor}; font-weight: 600;">+${grimAge.toFixed(1)} years</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                    <span style="font-size: 0.85em; color: #374151; font-weight: 600;">CV Risk Increase:</span>
                                    <span style="font-size: 0.85em; color: ${tissueColor}; font-weight: 600;">+${Math.round(cvRisk)}%</span>
                                </div>
                            </div>
                        ` : ''}
                        <p style="margin: 0; font-size: 0.85em; color: #6b7280;">
                            ${isMetabolic 
                                ? `üü¢ Hippocampal volume stable, cardiovascular health ${grimAge < 0 ? 'improving (meaningful work effect)' : 'maintained'}, no arterial stiffening` 
                                : scenario.sensitivity === 'dandelion' 
                                    ? `üî¥ Silent damage: hippocampal volume -${Math.round(month * 0.7)}%, arterial stiffening, early hypertension developing over ${month} months` 
                                    : `üî¥ Hippocampal volume declining, cardiovascular stress markers accumulating`}
                        </p>
                    </div>
                    <p style="margin: 5px 0 0 0; font-size: 0.8em; color: #9ca3af;"><em>Sapolsky Ch. 10-11: Measurable structural changes after 3-6 months chronic stress</em></p>
                </div>
            `;
            
            // LEVEL 6: SYSTEM-WIDE (Months-Years)
            const fhriStatus = fhri >= 70 ? 'good' : fhri >= 50 ? 'warning' : 'critical';
            const fhriColor = fhriStatus === 'good' ? '#10b981' : fhriStatus === 'warning' ? '#f59e0b' : '#ef4444';
            const fhriBar = `<div style="width: ${Math.round(fhri)}%; height: 20px; background: ${fhriColor}; border-radius: 4px; transition: all 0.3s;"></div>`;
            
            html += `
                <div style="margin-bottom: 15px; padding: 12px; background: white; border-left: 4px solid ${fhriColor}; border-radius: 4px;">
                    <h5 style="margin: 0 0 8px 0; color: #374151; font-size: 0.95em;">üíä SYSTEM-WIDE (Months-Years)</h5>
                    <p style="margin: 0 0 5px 0; font-size: 0.85em; color: #4b5563;"><strong>Mechanism:</strong> Disease manifestation, metabolic syndrome, immune dysfunction</p>
                    <div style="margin: 8px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                            <span style="font-size: 0.85em; color: #374151; font-weight: 600;">FHRI (Functional Capacity):</span>
                            <span style="font-size: 0.85em; color: ${fhriColor}; font-weight: 600;">${Math.round(fhri)}</span>
                        </div>
                        <div style="width: 100%; background: #e5e7eb; border-radius: 4px; overflow: hidden;">
                            ${fhriBar}
                        </div>
                    </div>
                    <p style="margin: 8px 0 0 0; font-size: 0.85em; color: #6b7280;">
                        ${isMetabolic 
                            ? `üü¢ ${fhri >= 85 ? 'Thriving - all systems flourishing, on trajectory for longevity' : 'Healthy functioning - sustainable workload, body recovering properly'}` 
                            : `üî¥ ${fhri < 50 ? 'Pre-disease state - ' + month + ' months exposure, trajectory toward chronic illness (hypertension, diabetes, autoimmune)' : 'Early warning signs - system strain accumulating, disease risk rising'}`}
                    </p>
                    <p style="margin: 5px 0 0 0; font-size: 0.8em; color: #9ca3af;"><em>Sapolsky Ch. 12-14: Chronic disease manifests over months-years of sustained stress</em></p>
                </div>
            `;
            
            // LEVEL 7: BEHAVIORAL/PSYCHOLOGICAL (Immediate-Ongoing)
            const mfpStatus = mfp <= 0.3 ? 'good' : mfp <= 0.6 ? 'warning' : 'critical';
            const mfpColor = mfpStatus === 'good' ? '#10b981' : mfpStatus === 'warning' ? '#f59e0b' : '#ef4444';
            const mfpBar = `<div style="width: ${Math.round(mfp * 100)}%; height: 20px; background: ${mfpColor}; border-radius: 4px; transition: all 0.3s;"></div>`;
            
            html += `
                <div style="margin-bottom: 15px; padding: 12px; background: white; border-left: 4px solid ${mfpColor}; border-radius: 4px;">
                    <h5 style="margin: 0 0 8px 0; color: #374151; font-size: 0.95em;">üß† BEHAVIORAL/PSYCHOLOGICAL (Immediate-Ongoing)</h5>
                    <p style="margin: 0 0 5px 0; font-size: 0.85em; color: #4b5563;"><strong>Mechanism:</strong> Symptom manifestation, identity changes, behavioral adaptations</p>
                    <div style="margin: 8px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                            <span style="font-size: 0.85em; color: #374151; font-weight: 600;">MFP (Moral Debt):</span>
                            <span style="font-size: 0.85em; color: ${mfpColor}; font-weight: 600;">${Math.round(mfp * 100)}%</span>
                        </div>
                        <div style="width: 100%; background: #e5e7eb; border-radius: 4px; overflow: hidden;">
                            ${mfpBar}
                        </div>
                    </div>
                    <p style="margin: 8px 0 0 0; font-size: 0.85em; color: #6b7280;">
                        ${isMetabolic 
                            ? `üü¢ Moral satisfaction - values-aligned work, identity intact, meaningful contribution` 
                            : `üî¥ ${mfp > 0.7 ? 'Severe moral injury - identity fragmented, cynicism, feel like fraud' : mfp > 0.5 ? 'Significant moral debt - guilt about compromises, avoiding thinking about values' : 'Early moral stress - beginning to cut corners, tension between values and demands'}`}
                    </p>
                    <p style="margin: 5px 0 0 0; font-size: 0.8em; color: #9ca3af;"><em>Symptoms appear immediately but pattern develops over weeks-months</em></p>
                </div>
            `;
            
            // KEY INSIGHT
            html += `
                <div style="margin-top: 20px; padding: 15px; background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 4px;">
                    <p style="margin: 0; font-size: 0.9em; color: #78350f; font-weight: 600;">
                        üîë KEY INSIGHT: All levels affected simultaneously at different timescales.
                    </p>
                    <p style="margin: 8px 0 0 0; font-size: 0.85em; color: #92400e;">
                        ${isMetabolic 
                            ? 'In metabolic institutions: Every level supports flourishing. Eustress builds capacity at all scales.' 
                            : 'In extractive institutions: ONE design choice (inadequate staffing, impossible quotas) damages ALL 7 levels. Neural ‚Üí hormonal ‚Üí cellular ‚Üí tissue ‚Üí system ‚Üí disease. This is how institutional design becomes biological reality.'}
                    </p>
                </div>
            `;
            
            contentEl.innerHTML = html;
        }
        
        function showComparisonSummary() {
            const summaryEl = document.getElementById('comp-summary-content');
            const fhriA = Math.round(comparisonState.scenarioA.data.fhri[12]);
            const fhriB = Math.round(comparisonState.scenarioB.data.fhri[12]);
            const grimAgeA = comparisonState.scenarioA.data.grimAge[12];
            const grimAgeB = comparisonState.scenarioB.data.grimAge[12];
            const cvRiskA = comparisonState.scenarioA.data.cvRisk[12];
            const cvRiskB = comparisonState.scenarioB.data.cvRisk[12];
            
            let html = '<h3>üìä 12-Month Comparison Complete</h3>';
            html += '<p style="font-size: 0.9em; color: #718096; margin-bottom: 15px;">One-year timeline matches published turnover data</p>';
            html += '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">';
            
            html += '<div style="border: 3px solid #667eea; padding: 15px; border-radius: 8px;">';
            html += '<p style="font-weight: 600; color: #667eea; margin-bottom: 10px;">SCENARIO A</p>';
            html += `<p style="font-size: 2em; font-weight: 700; color: ${fhriA >= 70 ? '#48bb78' : fhriA >= 50 ? '#ed8936' : '#f56565'};">FHRI: ${fhriA}</p>`;
            html += `<p>${fhriA >= 70 ? '‚úì Thriving' : fhriA >= 50 ? '‚ö† Struggling' : 'üö® Crisis'}</p>`;
            if (comparisonState.scenarioA.sensitivity === 'dandelion' && grimAgeA > 0) {
                html += `<p style="margin-top: 10px; color: #c53030; font-weight: 600;">Hidden: +${grimAgeA.toFixed(1)}y GrimAge, +${Math.round(cvRiskA)}% CV Risk</p>`;
            }
            html += '</div>';
            
            html += '<div style="border: 3px solid #48bb78; padding: 15px; border-radius: 8px;">';
            html += '<p style="font-weight: 600; color: #48bb78; margin-bottom: 10px;">SCENARIO B</p>';
            html += `<p style="font-size: 2em; font-weight: 700; color: ${fhriB >= 70 ? '#48bb78' : fhriB >= 50 ? '#ed8936' : '#f56565'};">FHRI: ${fhriB}</p>`;
            html += `<p>${fhriB >= 70 ? '‚úì Thriving' : fhriB >= 50 ? '‚ö† Struggling' : 'üö® Crisis'}</p>`;
            if (comparisonState.scenarioB.sensitivity === 'dandelion' && grimAgeB > 0) {
                html += `<p style="margin-top: 10px; color: #c53030; font-weight: 600;">Hidden: +${grimAgeB.toFixed(1)}y GrimAge, +${Math.round(cvRiskB)}% CV Risk</p>`;
            }
            html += '</div>';
            
            html += '</div>';
            
            html += '<p style="margin-top: 20px;"><strong>Key Insights:</strong></p>';
            const diff = Math.abs(fhriA - fhriB);
            if (diff > 20) {
                html += `<p>Substantial FHRI difference (${diff} points) demonstrates how institutional design determines outcomes far more than individual effort.</p>`;
            }
            
            // NEW: Dandelion-specific warning
            const isDandelionA = comparisonState.scenarioA.sensitivity === 'dandelion';
            const isDandelionB = comparisonState.scenarioB.sensitivity === 'dandelion';
            
            if ((isDandelionA && comparisonState.scenarioA.environment === 'extractive' && fhriA > 50) ||
                (isDandelionB && comparisonState.scenarioB.environment === 'extractive' && fhriB > 50)) {
                html += '<p style="margin-top: 15px; padding: 15px; background: #fff5f5; border-left: 4px solid #f56565; border-radius: 4px;">';
                html += '<strong>‚ö†Ô∏è The Dandelion Trap Demonstrated:</strong> ';
                html += 'An FHRI above 50 looks "functional," but dandelions accumulate severe hidden damage in extractive environments. ';
                html += `Total harm (visible FHRI decline + hidden biological aging) is GREATER than orchid's visible collapse. `;
                html += 'This is why low turnover can mask worse outcomes than high turnover.';
                html += '</p>';
            }
            
            summaryEl.innerHTML = html;
            document.getElementById('comp-final-summary').style.display = 'block';
            
            announce('12-month comparison complete. Timeline matches real-world data. Review summary for detailed results.');
        }
        
        function resetComparison() {
            pauseComparison();
            comparisonState.month = 0;
            comparisonState.choicePointShown = false;
            document.getElementById('comp-week-display').textContent = '0';
            document.getElementById('comp-final-summary').style.display = 'none';
            document.getElementById('choice-modal').style.display = 'none';
            
            // Keep speed setting - don't reset it
            // comparisonState.speed stays as user configured
            
            comparisonState.scenarioA.data = { 
                lgc: [calculateInitialLGC(comparisonState.scenarioA.sensitivity)], 
                cpfc: [0.85], 
                mfp: [0], 
                fhri: [78],
                grimAge: [0],
                cvRisk: [0]
            };
            comparisonState.scenarioA.events = [{month: 0, type: 'milestone', text: 'Simulation begins - Month 0 baseline'}];
            comparisonState.scenarioA.choiceMade = null;
            
            comparisonState.scenarioB.data = { 
                lgc: [calculateInitialLGC(comparisonState.scenarioB.sensitivity)], 
                cpfc: [0.85], 
                mfp: [0], 
                fhri: [78],
                grimAge: [0],
                cvRisk: [0]
            };
            comparisonState.scenarioB.events = [{month: 0, type: 'milestone', text: 'Simulation begins - Month 0 baseline'}];
            comparisonState.scenarioB.choiceMade = null;
            
            updateComparisonDisplay();
            announce('Comparison reset to month zero. Speed setting maintained.');
        }
    </script>
</body>
</html>
